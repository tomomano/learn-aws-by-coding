<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Tomoyuki Mano">
<title>Learn AWS by Coding (LABC)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Learn AWS by Coding (LABC)</h1>
<div class="details">
<span id="author" class="author">Tomoyuki Mano</span><br>
<span id="email" class="email"><a href="mailto:tomoyukimano@gmail.com">tomoyukimano@gmail.com</a></span><br>
<span id="revnumber">version 1.0-en,</span>
<span id="revdate">2021-09-17</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_purpose_and_content_of_this_book">1.1. Purpose and content of this book</a></li>
<li><a href="#_philosophy_of_this_book">1.2. Philosophy of this book</a></li>
<li><a href="#_aws_account">1.3. AWS account</a></li>
<li><a href="#_setting_up_an_environment">1.4. Setting up an environment</a></li>
<li><a href="#_docker_image_for_the_hands_on_exercise">1.5. Docker image for the hands-on exercise</a></li>
<li><a href="#_prerequisite_knowledge">1.6. Prerequisite knowledge</a></li>
<li><a href="#_source_code">1.7. Source code</a></li>
<li><a href="#_notations_used_in_this_book">1.8. Notations used in this book</a></li>
</ul>
</li>
<li><a href="#chap_cloud_basics">2. Cloud Computing Basics</a>
<ul class="sectlevel2">
<li><a href="#_what_is_the_cloud">2.1. What is the cloud?</a></li>
<li><a href="#_why_use_the_cloud">2.2. Why use the cloud?</a></li>
</ul>
</li>
<li><a href="#sec_aws_general_introduction">3. Introduction to AWS</a>
<ul class="sectlevel2">
<li><a href="#_what_is_aws">3.1. What is AWS?</a></li>
<li><a href="#_functions_and_services_provided_by_aws">3.2. Functions and services provided by AWS</a></li>
<li><a href="#_regions_and_availability_zones">3.3. Regions and Availability Zones</a></li>
<li><a href="#_cloud_development_in_aws">3.4. Cloud development in AWS</a></li>
<li><a href="#sec:intro_cloudformation">3.5. CloudFormation and AWS CDK</a></li>
</ul>
</li>
<li><a href="#sec_first_ec2">4. Hands-on #1: Launching an EC2 instance</a>
<ul class="sectlevel2">
<li><a href="#handson_01_prep">4.1. Preparation</a></li>
<li><a href="#_ssh">4.2. SSH</a></li>
<li><a href="#_reading_the_application_source_code">4.3. Reading the application source code</a></li>
<li><a href="#sec_handson_ec2_run">4.4. Deploying the application</a></li>
<li><a href="#_summary">4.5. Summary</a></li>
</ul>
</li>
<li><a href="#sec:appendix_settingup">5. Appendix: Environment setup</a>
<ul class="sectlevel2">
<li><a href="#sec:create_aws_account">5.1. Creating an AWS account</a></li>
<li><a href="#aws_secrets">5.2. Creating AWS access key</a></li>
<li><a href="#aws_cli_install">5.3. Installing AWS CLI</a></li>
<li><a href="#aws_cdk_install">5.4. Installing AWS CDK</a></li>
<li><a href="#sec:install_wsl">5.5. Installing WSL</a></li>
<li><a href="#sec:install_docker">5.6. Installing Docker</a></li>
<li><a href="#venv_quick_guide">5.7. Quick tutorial on Python <code>venv</code></a></li>
<li><a href="#sec_handson_docker">5.8. Working with Docker image for the hands-on exercise</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>ðŸŒŽJapanese version is available
<a href="https://tomomano.github.io/learn-aws-by-coding/">here</a>ðŸŒŽ</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose_and_content_of_this_book">1.1. Purpose and content of this book</h3>
<div class="paragraph">
<p>This book was prepared as a lecture material for "Special Lectures on Information Physics and Computing", which was offered in the S1/S2 term of the 2021 academic year at the Department of Mathematical Engineering and Information Physics, the University of Tokyo.</p>
</div>
<div class="paragraph">
<p>The purpose of this book is to explain the basic knowledge and concepts of cloud computing for beginners.
It provides hands-on tutorials to use real cloud environment provided by Amazon Web Services (AWS).</p>
</div>
<div class="paragraph">
<p>We assume that the readers would be students majoring science or engineering at college, or software engineers who are starting to develop cloud applications.
We will introduce pracitcal steps to use the cloud for research and web application development.
We plan to keep this course as interactive and practical as possible, and for that purpose, less emphasis is placed on the theories and knowledge, and more effort is placed on writing real programs.
I hope that this book serves as a stepping stone for readers to use cloud computing in their future research and applications.</p>
</div>
<div class="paragraph">
<p>The book is divided into three parts:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Structure of this book</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Theme</th>
<th class="tableblock halign-left valign-top">Hands-on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1st Part (Section 1 to 4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Fundamentals</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Launching an EC2 instance</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2nd Part (Section 5 to 9)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine Learning using Cloud</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Deep Learning by using AWS and Jupyter</p>
</li>
<li>
<p>Creating a scalable question-answering bot</p>
</li>
<li>
<p>Massively parallelized hyperparameter search</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3rd Part (Section 10 to 13)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Introduction to Serverless Architecture</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Tutorials on Lambda, DynamoDB, and S3</p>
</li>
<li>
<p>"Bashoutter", a SNS for Haiku</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the first part, we explain the basic concepts and knowledge of cloud computing.
Essential ideas necessary to safely and cleverly use cloud will be covered, including security and networking.
In the hands-on session, we will practice setting up <strong>a simple virtual server on AWS using AWS API and AWS CDK</strong>.</p>
</div>
<div class="paragraph">
<p>In the second part, we introduce the cocenpts and techniques for running <strong>scientific computing</strong> (especially <strong>machine learning</strong>) in the cloud.
In parallel, we will learn a modern virtual coumputing environment called <a href="https://www.docker.com/">Docker</a>.
In the first hands-on session, we will run Jupyter Notebook in the AWS cloud and run a simple machine learning program.
In the second hands-on, we will create a bot that automatically generates answers to questions using natural language model powered by deep neural network.
In the third hands-on, we will show how to launch a cluster with multiple GPU instances and perform massively parallel hyperparameter search for deep learning.</p>
</div>
<div class="paragraph">
<p>In the third part, we introduce the latest cloud architecture called <strong>serverless architecture</strong>.
This architecture introduces radically different design concept to the cloud than the previous one (often referred to as Serverful), as it allows the processing capacity of the cloud system to be scaled up or down more flexibly depending on the load.
In the first hands-on session, we will provide exercises on Lambda, DynamoDB, and S3, which are the main components of the serverless cloud.
In addition, we will create a simple yet quite useful social network service (SNS) in the cloud using serverless technology.</p>
</div>
<div class="paragraph">
<p>These extensive hands-on sessions will provide you with the knowledge and skills to develop your own cloud system on AWS.
All of the hands-on programs are designed to be practical, and can be customized for a variety of applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="_philosophy_of_this_book">1.2. Philosophy of this book</h3>
<div class="paragraph">
<p>The philosophy of this book can be summed up in one word:
<strong>"Let&#8217;s fly to space in a rocket and look at the earth once!"</strong></p>
</div>
<div class="paragraph">
<p>What does that mean?</p>
</div>
<div class="paragraph">
<p>The "Earth" here refers to the whole picture of cloud computing.
Needless to say, cloud computing is a very broad and complex concept, and it is the sum of many information technologies, hardware, and algorithms that have been elaborately woven together.
Today, many parts of our society, from scientific research to everyday infrastructure, are supported by cloud technology.</p>
</div>
<div class="paragraph">
<p>The word "rocket" here refers to this lecture.
In this lecture, readers will fly into space on a rocket and look at the entire earth (cloud) with their own eyes.
In this journey, we do not ask deeply about the detailed machinery of the rocket (i.e. elaborate theories and algorithms).
Rather, the purpose of this book is to let you actually touch the cutting edge technologies of cloud computing and realize what kind of views (and applications) are possible from there.</p>
</div>
<div class="paragraph">
<p>For this reason, this book covers a wide range of topics from the basics to advanced applications of cloud computing.
The first part of the book starts with the basics of cloud computing, and the second part takes it to the next level by explaining how to execute machine learning algorithms in the cloud.
In the third part, we will explain serverless architecture, a completely new cloud design that has been established in the last few years.
Each of these topic is worth more than one book, but this book was written with the ambitious intention of combining them into a single volume and providing a integrative and comprehensive overview.</p>
</div>
<div class="paragraph">
<p>It may not be an easy ride, but we promise you that if you hang on to this rocket, you will get to see some very exciting sights.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="imgs/earth_from_earth.jpg" alt="earth" width="500">
</div>
<div class="title">Figure 1. Earth viewed from space (Image from NASA <a href="https://www.nasa.gov/image-feature/planet-of-clouds" class="bare">https://www.nasa.gov/image-feature/planet-of-clouds</a>)</div>
</div>
</div>
<div class="sect2">
<h3 id="_aws_account">1.3. AWS account</h3>
<div class="paragraph">
<p>This book provides hands-on tutorials to run and deploy applications on AWS.
Readers must have their own AWS account to run the hands-on excercises.
A brief description of how to create an AWS account is given in the appendix at the end of the book (<a href="#sec:create_aws_account">Section 5.1</a>), so please refer to it if necessary.</p>
</div>
<div class="paragraph">
<p>AWS offers free access to some features, and some hands-on excercises can be done for free.
Other hands-on sessions (especially those dealing with machine learning) will cost a few dollars.
The approximate cost of each hands-on is described at the begining of the excercise, so please be aware of the potential cost.</p>
</div>
<div class="paragraph">
<p>In addition, when using AWS in lectures at universities and other educational institutions,
<a href="https://aws.amazon.com/education/awseducate/">AWS Educate</a>
program is available.
This program offers educators various teaching resources, including the AWS credits which students taking the course can use to run applications in the AWS cloud.
By using AWS Educate, students can experience AWS without any financial cost.
It is also possible for individuals to participate in AWS Educate without going through lectures.
AWS Educate provides a variety of learning materials, and I encourage you to take advantage of them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_an_environment">1.4. Setting up an environment</h3>
<div class="paragraph">
<p>In this book, we will provide hands-on sessions to deploy a cloud application on AWS.
The following computer environment is required to run the programs provided in this book.
The installation procedure is described in the appendix at the end of the book (<a href="#sec:appendix_settingup">Section 5</a>).
Refer to the appendix as necessary and set up an environment in your local computer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>UNIX console</strong>:
A UNIX console is required to execute the commands and access the server via SSH.
Mac or Linux users can use the console (also known as a terminal) that comes standard with the OS.
For Windows users, we recommend to install
<a href="https://docs.microsoft.com/en-us/windows/wsl/about">Windows Subsystem for Linux (WSL)</a>
and set up a virtual Linux environment
(see <a href="#sec:install_wsl">Section 5.5</a> for more details).</p>
</li>
<li>
<p><strong><a href="https://www.docker.com/">Docker</a></strong>:
This book explains how to use a virtual computing environment called Docker.
For the installation procedure, see <a href="#sec:install_docker">Section 5.6</a>.</p>
</li>
<li>
<p><strong><a href="https://github.com/python">Python</a></strong>:
Version 3.6 or later is required.
We will also use <code>venv</code> module to run programs.
A quick tutorial on <code>venv</code> module is provided in the appendix (<a href="#venv_quick_guide">Section 5.7</a>).</p>
</li>
<li>
<p><strong><a href="https://github.com/nodejs/node">Node.js</a></strong>:
Version 12.0 or later is required.</p>
</li>
<li>
<p><strong><a href="https://github.com/aws/aws-cli">AWS CLI</a></strong>:
WS CLI
<a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html">Version 2</a>
is required.
Refer to <a href="#aws_cli_install">Section 5.3</a> for installation and setup procedure.</p>
</li>
<li>
<p><strong><a href="https://github.com/aws/aws-cdk">AWS CDK</a></strong>:
Version 1.00 or later is required.
The tutorials are not compatible with version 2.
Refer to <a href="#aws_cdk_install">Section 5.4</a> for installation and setup procedure.</p>
</li>
<li>
<p><strong>AWS secret keys</strong>:
In order to call the AWS API from the command line, an authentication key (secret key) must be set.
Refer to <a href="#aws_cli_install">Section 5.3</a> for the setting of the authentication key.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_docker_image_for_the_hands_on_exercise">1.5. Docker image for the hands-on exercise</h3>
<div class="paragraph">
<p>We provide a Docker image with the required programs installed, such as Python, Node.js, and AWS CDK.
The source code of the hands-on program has also been included in the image.
If you already know how to use Docker, then you can use this image to immediately start the hands-on tutorials without having to install anything else.</p>
</div>
<div class="paragraph">
<p>Start the the container with the followign command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>docker run <span class="nt">-it</span> tomomano/labc</code></pre>
</div>
</div>
<div class="paragraph">
<p>More details on this Docker image is given in the appendix (<a href="#sec_handson_docker">Section 5.8</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisite_knowledge">1.6. Prerequisite knowledge</h3>
<div class="paragraph">
<p>The only prerequisite knowledge required to read this book is an elementary level understanding of the computer science taught at the universities (OS, programming, etc.).
No further prerequisite knowledge is assumed.
There is no need to have any experience using cloud computing.
However, the following prior knowledge will help you to understand more smoothly.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Basic skills in Python</strong>:
In this book, we will use Python to write programs.
The libraries we will be using are sufficiently abstract that most of the functions make sense just by looking at their names.
There is no need to worry if you are not very familiar with Python.</p>
</li>
<li>
<p><strong>Basic skills in Linux command line</strong>:
When using the cloud, the servers that are launched on the cloud are usually Linux.
If you have knowledge of the Linux command line, it will be easier to troubleshoot.
If you feel unconfident about using command line, I recommend this book:
<a href="http://linuxcommand.org/tlcl.php">The Linux Command Line by William Shotts</a>.
It is available for free on the web.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_source_code">1.7. Source code</h3>
<div class="paragraph">
<p>The source code of the hands-on tutorials is available at the following GitHub repository.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/tomomano/learn-aws-by-coding" class="bare">https://github.com/tomomano/learn-aws-by-coding</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_notations_used_in_this_book">1.8. Notations used in this book</h3>
<div class="ulist">
<ul>
<li>
<p>Code and shell commands are displayed with <code>monospace letters</code></p>
</li>
<li>
<p>The shell commands are prefixed with <code>$</code> symbol to make it clear that they are shell command.
The <code>$</code> must be removed when copying and pasting the command.
On the other hand, note that the output of a command does not have the <code>$</code> prefix.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, we provide warnings and tips in the boxes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Additional comments are provided here.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Advanced discussions and ideas are provided here.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Common mistakes will be provided here.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Mistakes that should never be made will be provided here.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap_cloud_basics">2. Cloud Computing Basics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_the_cloud">2.1. What is the cloud?</h3>
<div class="imageblock text-center">
<div class="content">
<img src="imgs/cloud_word_art.png" alt="Cloud" width="400">
</div>
</div>
<div class="paragraph">
<p>What is the cloud?
The term "cloud" has a very broad meaning in itself, so it is difficult to give a strict definition.
In academic context,
<a href="https://csrc.nist.gov/publications/detail/sp/800-145/final">The NIST Definition of Cloud Computing</a>,
published by National Institute of Standards and Technology (NIST), is often cited to define cloud computing.
The definition and model of cloud described here is illustrated in <a href="#fig:nist_cloud_definition">Figure 2</a>.</p>
</div>
<div id="fig:nist_cloud_definition" class="imageblock text-center">
<div class="content">
<img src="imgs/nist_cloud_definition.png" alt="Cost" width="700">
</div>
<div class="title">Figure 2. The NIST Definition of Cloud Computing</div>
</div>
<div class="paragraph">
<p>According to this, a cloud is a collection of hardware and software that meets the following requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>On-demand self-service</strong>:
Computational resources are automatically allocated according to the user&#8217;s request.</p>
</li>
<li>
<p><strong>Broad network access</strong>:
Users can access the cloud through the network.</p>
</li>
<li>
<p><strong>Resource pooling</strong>:
The cloud provider allocates computational resources to multiple users by dividing the owned computational resources.</p>
</li>
<li>
<p><strong>Rapid elasticity</strong>:
To be able to quickly expand or reduce computational resources according to the user&#8217;s request.</p>
</li>
<li>
<p><strong>Measured service</strong>:
To be able to measure and monitor the amount of computing resources used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This may sound too abstract for you to understand.
Let&#8217;s talk about it in more concrete terms.</p>
</div>
<div class="paragraph">
<p>If you wanted to upgrade the CPU on your personal computer, you would have to physically open the chassis, expose the CPU socket, and replace it with a new CPU.
Or, if the storage is full, you will need to remove the old disk and insert a new one.
When the computer is moved to a new location, it will not be able to connect to the network until the LAN cable of the new room is plugged in.</p>
</div>
<div class="paragraph">
<p>In the cloud, these operations can be <strong>performed by commands from a program</strong>.
If you want 1000 CPUs, you can send a request to the cloud provider.
Within a few minutes, you will be allocated 1000 CPUs.
If you want to expand your storage from 1TB to 10TB, you can send such command (you may be familiar with this from services such as Google Drive or Dropbox).
When you are done using the compute resources, you can tell the provider about it, and the allocation will be deleted immediately.
The cloud provider accurately monitors the amount of computing resources used, and calculates the usage fee based on that amount.</p>
</div>
<div class="paragraph">
<p>Namely, the essence of the cloud is the virtualization and abstraction of physical hardware, and <strong>users can manage and operate physical hardware through commands as if it were a part of software</strong>.
Of course, behind the scenes, a huge number of computers in data centers are running, consuming a lot of power.
The cloud provider achieves this virtualization and abstraction by cleverly managing the computational resources in the data center and providing the user with a software interface.
From the cloud provider&#8217;s point of view, they are able to maximize their profit margin by renting out computers to a large number of users and keeping the data center utilization rate close to 100% at all times.</p>
</div>
<div class="paragraph">
<p>In the author&#8217;s words, the key characteristics of the cloud can be defined as follows:</p>
</div>
<div class="quoteblock">
<blockquote>
The cloud is an abstraction of computing hardware.
In other words, it is a technology that makes it possible to manipulate, expand, and connect physical hardware as if it were part of software.
</blockquote>
</div>
<div class="paragraph">
<p>Coming back to The NIST Definition of Cloud Computing mentioned above, the following three forms of cloud services are defined (<a href="#fig:nist_cloud_definition">Figure 2</a>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Software as a Service (SaaS)</strong></p>
<div class="paragraph">
<p>A form of service that provides users with application running in the cloud.
Examples include Google Drive and Slack.
The user does not directly touch the underlying cloud infrastructure (network, servers, etc.), but use the cloud services provided as applications.</p>
</div>
</li>
<li>
<p><strong>Platform as a Service (PaaS)</strong></p>
<div class="paragraph">
<p>A form of service that provides users with an environment for deploying customer-created applications (which in most cases consist of a database and server code for processing API requests).
In PaaS, the user does not have direct access to the cloud infrastructure, and the scaling of the server is handled by the cloud provider.
Examples include Google App Engine and Heroku.</p>
</div>
</li>
<li>
<p><strong>Infrastructure as a Service (IaaS)</strong></p>
<div class="paragraph">
<p>A form of service that provides users with actual cloud computing infrastructure on a pay-as-you-go basis.
The users rent the necessary network, servers, and storage from the provider, and deploy and operate their own applications on it.
An example of IaaS is AWS EC2.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This book mainly deals with cloud development in IaaS.
In other words, it is cloud development in which the developer directly manipulates the cloud infrastructure, configures the desired network, server, and storage from scratch, and deploys the application on it.
In this sense, cloud development can be divided into two steps: <strong>the step of building a program that defines the cloud infrastructure</strong> and <strong>the step of crafting an application that actually runs on the infrastructure</strong>.
These two steps can be separated to some extent as a programmer&#8217;s skill set, but an understanding of both is essential to build the most efficient and optimized cloud system.
This book primarily focuses on the former (operating the cloud infrastructure), but also covers the application layer.
PaaS is a concept where the developer focuses on the application layer development and relies on the cloud provider for the cloud infrastructure.
PaaS reduces development time by eliminating the need to develop the cloud infrastructure, but has the limitation of not being able to control the detailed behavior of the infrastructure.
This book does not cover PaaS techniques and concepts.</p>
</div>
<div class="paragraph">
<p>SaaS can be considered a development "product" in the context of this book.
In other words, the final goal of development is to provide a computational service or database on the available to the general public by deploying the programs on IaaS platform.
As a practical demonstration, we will provide hands-on exercises such as creating a simple SNS (<a href="#sec_bashoutter">[sec_bashoutter]</a>).</p>
</div>
<div class="paragraph">
<p>Recently, Function as a Service (FaaS) and serverless computing have been recognized as new cloud categories.
These concepts will be discussed in detail in later chapters (<a href="#sec_intro_serverless">[sec_intro_serverless]</a>).
As will become clear as you read through this book, cloud technology is constantly and rapidly evolving.
This book first touches on traditional cloud design concepts from a practical and educational point of view, and then covers the latest technologies such as serverless.</p>
</div>
<div class="paragraph">
<p>Finally, according to The NIST Definition of Cloud Computing, the following four types of cloud deployment model are defined (<a href="#fig:nist_cloud_definition">Figure 2</a>).
<strong>Private cloud</strong> is a cloud used only within a specific organization, group, or company.
For example, universities and research institutes often operate large-scale computer servers for their members.
In a private cloud, any member of the organization can run computations for free or at a very low cost.
However, the upper limit of available computing resources is often limited, and there may be a lack of flexibility when expanding.</p>
</div>
<div class="paragraph">
<p><strong>Pubclic cloud</strong> is a cloud that is offered as a commercial service to general customers.
Examples of famous public cloud platforms include
<a href="https://cloud.google.com/">Google Cloud Platform (GCP)</a> provided by Google,
<a href="https://azure.microsoft">Azure</a> provided by Microsoft,
and <a href="https://aws.amazon.com">Amazon Web Services (AWS)</a> provided by Amazon.
When you use a public cloud, you pay the usage cost set by the provider.
In return, you get access to the computational resources of the company operating the huge data center, so it is not an exaggeration to say that the computational capacity is inexhaustible.</p>
</div>
<div class="paragraph">
<p>The third type of cloud operation is called <strong>community cloud</strong>.
This refers to a cloud that is shared and operated by groups and organizations that share the same objectives and roles, such as government agencies.
Finally, there is the <strong>hybrid cloud</strong>, which is a cloud composed of a combination of private, public, and community clouds.
An example of hybrid cloud would be a case where some sensitive and privacy-related information is kept in the private cloud, while the rest of the system depends on the public cloud.</p>
</div>
<div class="paragraph">
<p>This book is basically about cloud development using public clouds.
In particular, we will use Amazon Web Services (AWS) to learn specific techniques and concepts.
Note, however, that techniques such as server scaling and virtual computing environments are common to all clouds, so you should be able to acquire knowledge that is generally applicable regardless of the cloud platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="_why_use_the_cloud">2.2. Why use the cloud?</h3>
<div class="paragraph">
<p>As mentioned above, the cloud is a computational environment where computational resources can be flexibly manipulated through programs.
In this section, we would like to discuss why using the cloud is better than using a real local computing environment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Scalable server size</strong></p>
<div class="paragraph">
<p>When you start a new project, it&#8217;s hard to know in advance how much compute capacity you&#8217;ll ever need.
Buying a large server is risky.
On the other hand, a server that is too small can be troublesome to upgrade later on.
By using the cloud, you can secure the right amount of computing resources you need as you proceed with your project.</p>
</div>
</li>
<li>
<p><strong>Free from hardware maintainance</strong></p>
<div class="paragraph">
<p>Sadly, computers do get old.
With the rate at which technology is advancing these days, after five years, even the newest computers of the day are no more than fossils.
Replacing the server every five years would be a considerable hassle.
It is also necessary to deal with unexpected failures such as power outages and breakdowns of servers.
With cloud computing, there is no need for the user to worry about such things, as the provider automatically takes care of the infrastructure maintenance.</p>
</div>
</li>
<li>
<p><strong>Zero initial cost</strong></p>
<div class="paragraph">
<p><a href="#cloud_economic_curve">Figure 3</a> shows the economic cost of using your own computing environment versus the cloud.
The initial cost of using the cloud is basically zero.
After that, the cost increases according to the amount
of usage.
On the other hand, a large initial cost is incurred when using your own computing environment.
After the initial investment, the increase in cost is limited to electricity and server maintenance costs, so the slope is smaller than in the case of using the cloud.
Then, after a certain period of time, there may be step-like expenditures for server upgrades.
The cloud, on the other hand, incur no such discontinuous increase in cost.
In the areas where cost curve of the cloud is below that of local computing environment, using the cloud will lead to economic cost savings.</p>
</div>
</li>
</ol>
</div>
<div id="cloud_economic_curve" class="imageblock text-center">
<div class="content">
<img src="imgs/cloud_cost.png" alt="Cost" width="500">
</div>
<div class="title">Figure 3. Cost curve for cloud and local server</div>
</div>
<div class="paragraph">
<p>In particular, point 1 is important in research situations.
In research, there are few cases in which one must keep running computations all the time.
Rather, the computational load is likely to increase intensively and unexpectedly when a new algorithm is conceived, or when new data arrives.
In such cases, the ability to flexibly increase computing power is a major advantage of using the cloud.</p>
</div>
<div class="paragraph">
<p>So far, we have discussed the advantages of using the cloud, but there are also some disadvantages.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>The cloud must be used wisely</strong></p>
<div class="paragraph">
<p>As shown in the cost curve in <a href="#cloud_economic_curve">Figure 3</a>, depending on your use case, there may be situations where it is more cost effective to use local computing environment.
When using the cloud, users are required to manage their computing resources wisely, such as deleting intances immediately after use.</p>
</div>
</li>
<li>
<p><strong>Security</strong></p>
<div class="paragraph">
<p>The cloud is accessible from anywhere in the world via the Internet, and can be easily hacked if security management is neglected.
If the cloud is hacked, not only will information be leaked, but there is also the possibility of financial loss.</p>
</div>
</li>
<li>
<p><strong>Learning Curve</strong></p>
<div class="paragraph">
<p>As described above, there are many points to keep in mind when using the cloud, such as cost and security.
In order to use the cloud wisely, it is indispensable to have a good understanding of the cloud and to overcome the learning curve.</p>
</div>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Column: Origin of the word "Terminal"</div>
<div class="paragraph">
<p>The black screen that you use to enter commands on Mac or Linux is called a terminal.
Do you know the origin of this word?</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="imgs/terminal.png" alt="Terminal" width="400">
</div>
</div>
<div class="paragraph">
<p>The origin of this word goes back to the early days of computers.
At that time, a computer was a machine the size of a conference room, with thousands of vacuum tubes connected together.
Since it was such an expensive and complex piece of equipment, it was natural that it would be shared by many people.
In order for users to access the computer, there were several cables running from the machine, each with a keyboard and screen attached to it&#8230;&#8203;
This was called a <strong>Terminal</strong>.
People took turns sitting in front of the terminal and interacting with the computer.</p>
</div>
<div class="paragraph">
<p>Times change, and with the advent of personal computers such as Windows and Mac, computers have become something that is owned by individuals rather than shared by everyone.</p>
</div>
<div class="paragraph">
<p>The recent rise of cloud computing can be seen as a return to the original usage of computers, where everyone shared a large computer.
At the same time, edge devices such as smartphones and wearables are becoming more and more popular, and the trend of individuals owning multiple "small" computers is progressing at the same time.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec_aws_general_introduction">3. Introduction to AWS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_aws">3.1. What is AWS?</h3>
<div class="paragraph">
<p>In this book, AWS is used as the platform for implementing cloud applications.
In this chapter, we will explain the essential knowledge of AWS that is required for hands-on tutorials.</p>
</div>
<div class="paragraph">
<p><a href="https://aws.amazon.com">AWS (Amazon Web Services)</a>
is a general cloud platform provided by Amazon.
AWS was born in 2006 as a cloud service that leases vast computing resources that Amazon owns.
In 2021, AWS holds the largest market share (about 32%) as a cloud provider
(<a href="https://www.canalys.com/newsroom/global-cloud-market-Q121">Ref</a>).
Many web-related services, including Netflix and Slack, have some or all of their server resources provided by AWS.
Therefore, most of the readers would be benefiting from AWS without knowing it.</p>
</div>
<div class="paragraph">
<p>Because it has the largest market share, it offers a wider range of functions and services than any other cloud platforms.
In addition, reflecting the large number of users, there are many official and third-party technical articles on the web, which is helpful in learning and debugging.
In the early days, most of the users were companies engaged in web business, but recently, there is a growing number of users embracing AWS for scientific and engineering research.</p>
</div>
</div>
<div class="sect2">
<h3 id="_functions_and_services_provided_by_aws">3.2. Functions and services provided by AWS</h3>
<div class="paragraph">
<p><a href="#fig_aws_services">Figure 4</a> shows a list of the major services provided by AWS at the time of writing.</p>
</div>
<div id="fig_aws_services" class="imageblock text-center">
<div class="content">
<img src="imgs/aws_services.png" alt="AWS services" width="350">
</div>
<div class="title">Figure 4. List of major services provided by AWS</div>
</div>
<div class="paragraph">
<p>The various elements required to compose a cloud, such as computation, storage, database, network, and security, are provided as <strong>independent components</strong>.
Essentially, a cloud system is created by combining these components.
There are also pre-packaged services for specific applications, such as machine learning, speech recognition, and augmented reality (AR) and virtual reality (VR).
In total, there are more than 170 services provided.</p>
</div>
<div class="paragraph">
<p>AWS beginners often fall into a situation where they are overwhelmed by the large number of services and left at a loss.
It&#8217;s not even clear what concepts to learn and in what order, and this is undoubtedly a major barrier to entry.
However, the truth is that the essential components of AWS are limited to just a couple.
If you know how to use the essential components, you are almost ready to start developing on AWS.
Many of the other services are combinations of the basic elements that AWS has prepared as specialized packages for specific applications.
Recognizing this point is the first step in learning AWS.</p>
</div>
<div class="paragraph">
<p>Here, we list the essential components for building a cloud system on AWS.
You will experience them while writing programs in the hands-on sessions in later chapters.
At this point, it is enough if you could just memorize the names in a corner of your mind.</p>
</div>
<div class="sect3">
<h4 id="_computation">3.2.1. computation</h4>
<div class="paragraph">
<p><span class="image left"><img src="imgs/aws_logos/EC2.png" alt="S3" width="40"></span>
<strong>EC2 (Elastic Compute Cloud)</strong>
Virtual machines with various specifications can be created and used to perform calculations.
This is the most basic component of AWS.
We will explore more on EC2 in later chapters (<a href="#sec_first_ec2">Section 4</a>, <a href="#sec_jupyter_and_deep_learning">[sec_jupyter_and_deep_learning]</a>, <a href="#sec_aws_batch">[sec_aws_batch]</a>).</p>
</div>
<div class="paragraph">
<p><span class="image left"><img src="imgs/aws_logos/Lambda.png" alt="S3" width="40"></span>
<strong>Lambda</strong>
Lambda is a part of the cloud called Function as a Service (FaaS), a service for performing small computations without a server.
It will be described in detail in the chapter on serverless architecture (<a href="#sec_serverless">[sec_serverless]</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_storage">3.2.2. Storage</h4>
<div class="paragraph">
<p><span class="image left"><img src="imgs/aws_logos/EBS.png" alt="S3" width="40"></span>
<strong>EBS (Elastic Block Store)</strong>
A virtual data drive that can be assigned to EC2.
Think of a "conventional" file system as used in common operating systems.</p>
</div>
<div class="paragraph">
<p><span class="image left"><img src="imgs/aws_logos/S3.png" alt="S3" width="40"></span>
<strong>S3 (Simple Storage Service)</strong>
S3 is a "cloud-bative" data storage system called Object Storage, which uses APIs to read and write data.
It will be described in detail in the chapter on serverless architecture (<a href="#sec_serverless">[sec_serverless]</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_database">3.2.3. Database</h4>
<div class="paragraph">
<p><span class="image left"><img src="imgs/aws_logos/DynamoDB.png" alt="S3" width="40"></span>
<strong>DynamoDB</strong>
DynamoDB is a NoSQL type database service (think of <code>mongoDB</code> if you know it).
It will be described in detail in the chapter on serverless architecture (<a href="#sec_serverless">[sec_serverless]</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_networking">3.2.4. Networking</h4>
<div class="paragraph">
<p><span class="image left"><img src="imgs/aws_logos/VPC.png" alt="S3" width="40"></span>
<strong>VPC(Virtual Private Cloud)</strong>
With VPC, one can create a virtual network environment on AWS, define connections between virtual servers, and manage external access.
EC2 must be placed inside a VPC.</p>
</div>
<div class="paragraph">
<p><strong>API Gateway</strong>
<span class="image left"><img src="imgs/aws_logos/APIGateway.png" alt="S3" width="40"></span>
API Gateway acts as a reverse proxy to connect API endpoints to backend services (such as Lambda).
It will be described in detail in <a href="#sec_bashoutter">[sec_bashoutter]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_regions_and_availability_zones">3.3. Regions and Availability Zones</h3>
<div class="paragraph">
<p>One of the most important concepts you need to know when using AWS is <strong>Region</strong> and <strong>Availability Zone (AZ)</strong> (<a href="#fig_aws_regions_and_azs">Figure 5</a>).
In the following, we will briefly describe these concepts.
For more detailed information, also see
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">official documentation "Regions, Availability Zones, and Local Zones"</a>.</p>
</div>
<div id="fig_aws_regions_and_azs" class="imageblock text-center">
<div class="content">
<img src="imgs/aws_region_and_az.png" alt="AWS regions and azs" width="500">
</div>
<div class="title">Figure 5. Regions and availability zones in AWS</div>
</div>
<div class="paragraph">
<p>A <strong>region</strong> roughly means the location of a data center.
At the time of writing, AWS has data centers in 25 geographical locations around the world, as shown in <a href="#fig_aws_regions">Figure 6</a>.
In Japan, there are data centers in Tokyo and Osaka.
Each region has a unique ID, for example, Tokyo is defined as <code>ap-northeast-1</code>, Ohio as <code>us-east-2</code>, and so on.</p>
</div>
<div id="fig_aws_regions" class="imageblock text-center">
<div class="content">
<img src="imgs/aws_regions.png" alt="AWS regions" width="600">
</div>
<div class="title">Figure 6. Regions in AWS (Source: <a href="https://aws.amazon.com/about-aws/global-infrastructure/" class="bare">https://aws.amazon.com/about-aws/global-infrastructure/</a>)</div>
</div>
<div class="paragraph">
<p>When you log in to the AWS console, you can select a region from the menu bar at the top right of the screen (<a href="#fig_aws_console_regions">Figure 7</a>, circled in red).
AWS resources such as EC2 are completely independent for each region.
Therefore, when deploying new resources or viewing deployed resources, you need to <strong>make sure that the console region is set correctly</strong>.
If you are developing a web business, you will need to deploy the cloud in various parts of the world.
However, if you are using it for personal research, you are most likely fine just using the nearest region (e.g. Tokyo).</p>
</div>
<div id="fig_aws_console_regions" class="imageblock text-center">
<div class="content">
<img src="imgs/aws_regions2.png" alt="AWS console select regions" width="600">
</div>
<div class="title">Figure 7. Selecting a region in AWS console</div>
</div>
<div class="paragraph">
<p>An <strong>Avaialibity Zone (AZ)</strong> is a data center that is geographically isolated within a region.
Each region has two or more AZs, so that if a fire or power failure occurs in one AZ, the other AZs can cover the failure.
In addition, the AZs are connected to each other by high-speed dedicated network lines, so data transfer between AZs is extremely fast.
AZ is a concept that should be taken into account when server downtime is unacceptable, such as in web businesses.
For personal use, there is no need to be concerned much about it.
It is sufficient to know the meaning of the term.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using AWS, which region should you select?
In terms of Internet connection speed, it is generally best to use the region that is geographically closest to you.
On the other hand, EC2 usage fees, etc., are priced slightly differently for each region.
Therefore, it is also important to choose the region with the lowest price for the services that you use most frequently.
In addition, some services may not be available in a particular region.
It is best to make an overall judgment based on these points.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_cloud_development_in_aws">3.4. Cloud development in AWS</h3>
<div class="paragraph">
<p>Now that you have a general understanding of the AWS cloud, the next topic will be an overview of how to develop and deploy a cloud system on AWS.</p>
</div>
<div class="paragraph">
<p>There are two ways to perform AWS operations such as adding, editing, and deleting resources: <strong>using the console</strong> and <strong>using the API</strong>.</p>
</div>
<div class="sect3">
<h4 id="_operating_the_resources_through_the_console">3.4.1. Operating the resources through the console</h4>
<div class="paragraph">
<p>When you log in to your AWS account, the first thing you will see is the <strong>AWS Management Console</strong> (<a href="#aws_console_window">Figure 8</a>).</p>
</div>
<div id="aws_console_window" class="imageblock text-center">
<div class="content">
<img src="imgs/aws_console.png" alt="AWS console" width="600">
</div>
<div class="title">Figure 8. AWS Management Console</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this book we will often call AWS Management Console AWS console or just a console.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the console, you can peform any operations on AWS resources through a GUI (Graphical User Interface), such as launching EC2 instances, adding and deleting data in S3, viewing logs, and so on.
<strong>AWS console is very useful when you are trying out a new function for the first time or debugging the system</strong>.</p>
</div>
<div class="paragraph">
<p>The console is useful for quickly testing functions and debugging the cloud under development, but it is rarely used directly in actual cloud development.
Rather, it is more common to use the APIs to describe cloud resources programmatically.
For this reason, this book does not cover how to use AWS console.
The AWS documentation includes many
<a href="https://aws.amazon.com/getting-started/hands-on/">tutorials</a>
which describe how to perform various operations from the AWS console.
They are valuable resources for learning.</p>
</div>
</div>
<div class="sect3">
<h4 id="_operating_the_resources_through_the_apis">3.4.2. Operating the resources through the APIs</h4>
<div class="paragraph">
<p>By using <strong>API (Application Programming Interface)</strong>, you can send commands to AWS and manipulate cloud resources.
APIs are simply a list of commands exposed by AWS, and consisted of <strong>REST APIs</strong> (REST APIs are explained in <a href="#sec_rest_api">[sec_rest_api]</a>).
However, directly entering the REST APIs can be tedious, so various tools are provided to interact with AWS APIs more conveniently.</p>
</div>
<div class="paragraph">
<p>For example,
<a href="https://docs.aws.amazon.com/cli/latest/index.html">AWS CLI</a>
is a command line interface (CLI) to execute AWS APIs through UNIX console.
In addition to the CLI, SDKs (Software Development Kits) are available in a variety of programming languages.
Some examples are listed below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Python &#8658; <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html">boto3</a></p>
</li>
<li>
<p>Ruby &#8658; <a href="https://aws.amazon.com/sdk-for-ruby/">AWS SDK for Ruby</a></p>
</li>
<li>
<p>Node.js &#8658; <a href="https://aws.amazon.com/sdk-for-node-js/">AWS SDK for Node.js</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a some of the API examples.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume that you want to add a new storage space (called a <code>Bucket</code>) to S3.
If you use the AWS CLI, you can type a command like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>aws s3 mb s3://my-bucket <span class="nt">--region</span> ap-northeast-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command will create a bucket named <code>my-bucket</code> in the <code>ap-northeast-1</code> region.</p>
</div>
<div class="paragraph">
<p>To perform the same operation from Python, use the <code>boto3</code> library and run a script like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">boto3</span>

<span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">"s3"</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s">"ap-northeast-1"</span><span class="p">)</span>
<span class="n">s3_client</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s">"my-bucket"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s look at another example.</p>
</div>
<div class="paragraph">
<p>To start a new EC2 instance (an instance is a virtual server that is in the running state), use the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>aws ec2 run-instances <span class="nt">--image-id</span> ami-xxxxxxxx <span class="nt">--count</span> 1 <span class="nt">--instance-type</span> t2.micro <span class="nt">--key-name</span> MyKeyPair <span class="nt">--security-group-ids</span> sg-903004f8 <span class="nt">--subnet-id</span> subnet-6e7f829e</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will launch a
<a href="https://aws.amazon.com/ec2/instance-types/t2/">t2.micro</a>
instance with 1 vCPU and 1.0 GB RAM.
We&#8217;ll explain more about this command in later chapter (<a href="#sec_first_ec2">Section 4</a>).</p>
</div>
<div class="paragraph">
<p>To perform the same operation from Python, use a script like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">boto3</span>

<span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">"ec2"</span><span class="p">)</span>
<span class="n">ec2_client</span><span class="o">.</span><span class="n">run_instances</span><span class="p">(</span>
    <span class="n">ImageId</span><span class="o">=</span><span class="s">"ami-xxxxxxxxx"</span><span class="p">,</span>
    <span class="n">MinCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">MaxCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">KeyName</span><span class="o">=</span><span class="s">"MyKeyPair"</span><span class="p">,</span>
    <span class="n">InstanceType</span><span class="o">=</span><span class="s">"t2.micro"</span><span class="p">,</span>
    <span class="n">SecurityGroupIds</span><span class="o">=</span><span class="p">[</span><span class="s">"sg-903004f8"</span><span class="p">],</span>
    <span class="n">SubnetId</span><span class="o">=</span><span class="s">"subnet-6e7f829e"</span><span class="p">,</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Through the above examples, we hope you are starting to get an idea of how APIs can be used to manipulate cloud resources.
With a single command, you can start a new virtual server, add a data storage area, or perform any other operation you want.
By combining multiple commands like this, you can build a computing environment with the desired CPU, RAM, network, and storage.
Of course, the delete operation can also be performed using the API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mini_hands_on_using_aws_cli">3.4.3. Mini hands-on: Using AWS CLI</h4>
<div class="paragraph">
<p>In this mini hands-on, we will learn how to use AWS CLI.
As mentioned earlier, AWS CLI can be used to manipulate any resource on AWS, but here we will practice the simplest case, <strong>reading and writing files using S3</strong>.
(EC2 operations are a bit more complicated, so we will cover them in <a href="#sec_first_ec2">Section 4</a>).
For detailed usage of the <code>aws s3</code> command, please refer to <a href="https://docs.aws.amazon.com/cli/latest/reference/s3/index.html#cli-aws-s3">official documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For information on installing the AWS CLI, see <a href="#aws_cli_install">Section 5.3</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The hands-on exercise described below can be performed within the
<a href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc">free S3 tier</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before executing the following commands, make sure that your AWS credentials are set correctly.
This requires that the settings are written to the file <code>~/.aws/credentials</code> or that the environment variables (<code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, and <code>AWS_DEFAULT_REGION</code>) are defined.
See <a href="#aws_cli_install">Section 5.3</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To begin with, let&#8217;s create a data storage space (called a <code>Bucket</code>) in S3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ bucketName</span><span class="o">=</span><span class="s2">"mybucket-</span><span class="si">$(</span>openssl rand <span class="nt">-hex</span> 12<span class="si">)</span><span class="s2">"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$bucketName</span>
<span class="nv">$ </span>aws s3 mb <span class="s2">"s3://</span><span class="k">${</span><span class="nv">bucketName</span><span class="k">}</span><span class="s2">"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the name of an S3 bucket must be unique across AWS, the above command generates a bucket name that contains a random string and stores it in a variable called <code>bucketName</code>.
Then, a new bucket is created by <code>aws s3 mb</code> command (<code>mb</code> stands for make bucket).</p>
</div>
<div class="paragraph">
<p>Next, let&#8217;s obtain a list of the buckets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>aws s3 <span class="nb">ls

</span>2020-06-07 23:45:44 mybucket-c6f93855550a72b5b66f5efe</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that the bucket we just created is in the list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As a notation in this book, terminal commands are prefixed with <code>$</code> to indicate that they are commands.
The <code>$</code> must be removed when copying and pasting commands.
Conversely, the output of a command is shown without <code>$</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, we upload the files to the bucket.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Hello world!"</span> <span class="o">&gt;</span> hello_world.txt
<span class="nv">$ </span>aws s3 <span class="nb">cp </span>hello_world.txt <span class="s2">"s3://</span><span class="k">${</span><span class="nv">bucketName</span><span class="k">}</span><span class="s2">/hello_world.txt"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we generated a dummy file <code>hello_world.txt</code> and uploaded it to the bucket.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s obtain a list of the files in teh bucket.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>aws s3 <span class="nb">ls</span> <span class="s2">"s3://</span><span class="k">${</span><span class="nv">bucketName</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--human-readable</span>

2020-06-07 23:54:19   13 Bytes hello_world.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that the file we just uploaded is in the list.</p>
</div>
<div class="paragraph">
<p>Lastly, we delete the bucket we no longer use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>aws s3 rb <span class="s2">"s3://</span><span class="k">${</span><span class="nv">bucketName</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--force</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>rb</code> stands for remove bucket.
By default, you cannot delete a bucket if there are files in it.
By adding the <code>--force</code> option, a non-empty bucket are forced to be deleted.</p>
</div>
<div class="paragraph">
<p>As we just saw, we were able to perform a series of operations on S3 buckets using the AWS CLI.
In the same manner, you can use the AWS CLI to perform operation on EC2, Lambda, DynamoDB, and any other resources.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Amazon Resource Name (ARN)</strong>.</p>
</div>
<div class="paragraph">
<p>Every resource on AWS is assigned a unique ID called Amazon Resource Name (ARN).
ARNs are written in a format like <code>arn:aws:s3:::my_bucket/</code>, and ARNs can be used to uniquely refer to a specific AWS resource.</p>
</div>
<div class="paragraph">
<p>In addition to ARNs, it is also possible to define human-readable names for S3 buckets and EC2 instances.
In this case, either the ARN or the name can be used to refer to the same resource.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:intro_cloudformation">3.5. CloudFormation and AWS CDK</h3>
<div class="paragraph">
<p>As mentioned in the previous section, AWS APIs can be used to create and manage <strong>any</strong> resources in the cloud.
Therefore, in principle, you can construct cloud systems by combining API commands.</p>
</div>
<div class="paragraph">
<p>However, there is one practical point that needs to be considered here.
The AWS API can be broadly divided into <strong>commands to manipulate resources</strong> and <strong>commands to execute tasks</strong> (<a href="#fig_aws_iac">Figure 9</a>).</p>
</div>
<div id="fig_aws_iac" class="imageblock text-center">
<div class="content">
<img src="imgs/iac.png" alt="AWS console" width="500">
</div>
<div class="title">Figure 9. AWS APIs can be roughly divided into commands for manipulating resources and commands for executing tasks.</div>
</div>
<div class="paragraph">
<p><strong>Manipulating resources</strong> refers to <strong>preparing static resources</strong>, such as launching an EC2 instance, creating an S3 bucket, or adding a new table to a database.
Such commands need to be executed only once, when the cloud is deployed.</p>
</div>
<div class="paragraph">
<p><strong>Commands to execute tasks</strong> refer to operations such as submitting a job to an EC2 instance or writing data to an S3 bucket.
It describes the computation that should be performed within the premise of a static resource such as EC2 instance or S3 bucket.
Compared to the former, the latter can be regarded as being in charge of <strong>dynamic operations</strong>.</p>
</div>
<div class="paragraph">
<p>From this point of view, it would be clever to manage <strong>programs describing the infrastructure</strong> and <strong>programs executing tasks</strong> separately.
Therefore, the development of a cloud can be divided into two steps: one is to create programs that describe the static resources of the cloud, and the other is to create programs that perform dynamic operations.</p>
</div>
<div class="paragraph">
<p>CloudFormation is a mechanism for managing static resources in AWS.
CloudFormation defines the blueprint of the cloud infrastructure using text files that follow the CloudFormation syntax.
CloudFormation can be used to describe resource requirements, such as how many EC2 instances to launch, with what CPU power and networks configuration, and what access permissions to grant.
Once a CloudFormation file has been crafted, a cloud system can be deployed on AWS with a single command.
In addition, by exchanging CloudFormation files, it is possible for others to easily reproduce an identical cloud system.
This concept of describing and managing cloud infrastructure programmatically is called <strong>Infrastructure as Code (IaC)</strong>.</p>
</div>
<div class="paragraph">
<p>CloudFormation usually use a format called <strong>JSON</strong> (JavaScript Object Notation).
The following code is an example excerpt of a CloudFormation file written in JSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre><span class="nl">"Resources"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="err">...</span><span class="w">
  </span><span class="nl">"WebServer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::EC2::Instance"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"ImageId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Fn::FindInMap"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"AWSRegionArch2AMI"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Ref"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::Region"</span><span class="w"> </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w"> </span><span class="nl">"Fn::FindInMap"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"AWSInstanceType2Arch"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Ref"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"InstanceType"</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s2">"Arch"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nl">"InstanceType"</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Ref"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"InstanceType"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityGroups"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="nl">"Ref"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"WebServerSecurityGroup"</span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="nl">"KeyName"</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Ref"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"KeyName"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nl">"UserData"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Fn::Base64"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Fn::Join"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w">
                     </span><span class="s2">"#!/bin/bash -xe</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="w">
                     </span><span class="s2">"yum update -y aws-cfn-bootstrap</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="w">

                     </span><span class="s2">"/opt/aws/bin/cfn-init -v "</span><span class="p">,</span><span class="w">
                     </span><span class="s2">"         --stack "</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Ref"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::StackName"</span><span class="w"> </span><span class="p">},</span><span class="w">
                     </span><span class="s2">"         --resource WebServer "</span><span class="p">,</span><span class="w">
                     </span><span class="s2">"         --configsets wordpress_install "</span><span class="p">,</span><span class="w">
                     </span><span class="s2">"         --region "</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Ref"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::Region"</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="w">

                     </span><span class="s2">"/opt/aws/bin/cfn-signal -e $? "</span><span class="p">,</span><span class="w">
                     </span><span class="s2">"         --stack "</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Ref"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::StackName"</span><span class="w"> </span><span class="p">},</span><span class="w">
                     </span><span class="s2">"         --resource WebServer "</span><span class="p">,</span><span class="w">
                     </span><span class="s2">"         --region "</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Ref"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::Region"</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="w">
      </span><span class="p">]]}}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="err">,</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we have defined an EC2 instance named "WebServer".
This is a rather long and complex description, but it specifies all necessary information to create an EC2 instance.</p>
</div>
<div class="sect3">
<h4 id="_aws_cdk">3.5.1. AWS CDK</h4>
<div class="paragraph">
<p>As we saw in the previous section, CloudFormation is very complex to write, and there must not be any errors in any lines.
Further, since CloudFormation is written with JSON, we cannot use useful concepts such as variables and classes as we do in modern programming languages (strictly speaking, CloudFormation has functions that are equivalent to variables).
In addition, many parts of the CloudFormation files are repetitive, and many parts can be automated.</p>
</div>
<div class="paragraph">
<p>To solve this programmer&#8217;s pain,
<a href="https://aws.amazon.com/cdk/">AWS Cloud Development Kit (CDK)</a>
is offered by AWS.
<strong>CDK is a tool that automatically generates CloudFormations using a programming language such as Python.</strong>
CDK is a relatively new tool, released in 2019, and is being actively developed (check the releases at <a href="https://github.com/aws/aws-cdk/releases">GitHub repository</a> to see how fast this library is being improved).
CDK is supported by several languages including TypeScript (JavaScript), Python, and Java.</p>
</div>
<div class="paragraph">
<p>With CDK, programmers can use a familiar programming language to describe the deisred cloud resources and synthesize the CloudFormation files.
In addition, CDK determines many of the common parameters automatically, which reduces the amount of coding.</p>
</div>
<div class="paragraph">
<p>The following is an example excerpt of CDK code using Python.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">aws_cdk</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span><span class="p">,</span>
    <span class="n">aws_ec2</span> <span class="k">as</span> <span class="n">ec2</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">MyFirstEc2</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Stack</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">vpc</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">Vpc</span><span class="p">(</span>
            <span class="o">...</span> <span class="c1"># some parameters
</span>        <span class="p">)</span>

        <span class="n">sg</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">SecurityGroup</span><span class="p">(</span>
            <span class="o">...</span> <span class="c1"># some parameters
</span>        <span class="p">)</span>

        <span class="n">host</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">Instance</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s">"MyGreatEc2"</span><span class="p">,</span>
            <span class="n">instance_type</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">InstanceType</span><span class="p">(</span><span class="s">"t2.micro"</span><span class="p">),</span>
            <span class="n">machine_image</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">MachineImage</span><span class="o">.</span><span class="n">latest_amazon_linux</span><span class="p">(),</span>
            <span class="n">vpc</span><span class="o">=</span><span class="n">vpc</span><span class="p">,</span>
            <span class="o">...</span>
        <span class="p">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code describes essentially the same thing as the JSON-based CloudFormation shown in the previous section.
You can see that CDK code is much shorter and easier to understand than the very complicated CloudFormation file.</p>
</div>
<div class="paragraph">
<p><strong>The focus of this book is to help you learn AWS concepts and techniques while writing code using CDK</strong>.
In the later chapters, we will provide various hands-on exercises using CDK.
To kick start, in the first hands-on, we will learn how to launch a simple EC2 instance using CDK.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Further reading</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/aws-samples/aws-cdk-examples">AWS CDK Examples</a>:
Many example projects using the CDK are published here.
You can use the examples here as a template to develop your own applications.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec_first_ec2">4. Hands-on #1: Launching an EC2 instance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the first hands-on session, we will create an EC2 instance (virtual server) using CDK, and log in to the server using SSH.
After this hands-on, you will be able to set up your own server on AWS and run calculations as you wish!</p>
</div>
<div class="sect2">
<h3 id="handson_01_prep">4.1. Preparation</h3>
<div class="paragraph">
<p>The source code for the hands-on is available on GitHub at
<a href="https://github.com/tomomano/learn-aws-by-coding/tree/main/handson/ec2-get-started">handson/ec2-get-started</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This hands-on exercise can be performed within the
<a href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc">free EC2 tier</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, we set up the environment for the exercise.
This is a prerequisite for the hands-on sessions in later chapters as well, so make sure to do it now without mistakes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AWS account</strong>:
You will need a personal AWS account to run the hands-on.
See <a href="#sec:create_aws_account">Section 5.1</a> for obtaining an AWS account.</p>
</li>
<li>
<p><strong>Python and Node.js</strong>:
Python (3.6 or higher) and Node.js (12.0 or higher) must be installed in order to run this hands-on.</p>
</li>
<li>
<p><strong>AWS CLI</strong>:
For information on installing the AWS CLI, see <a href="#aws_cli_install">Section 5.3</a>.
Be sure to set up the authentication key described here.</p>
</li>
<li>
<p><strong>AWS CDK</strong>:
For information on installing the AWS CDK, see <a href="#aws_cdk_install">Section 5.4</a>.</p>
</li>
<li>
<p><strong>Downloading the source code</strong>:
Download the source code of the hands-on program from GitHub using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>git clone https://github.com/tomomano/learn-aws-by-coding.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can go to <a href="https://github.com/tomomano/learn-aws-by-coding" class="bare">https://github.com/tomomano/learn-aws-by-coding</a> and click on the download button in the upper right corner.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Using Docker image for the hands-on exercises</strong></p>
</div>
<div class="paragraph">
<p>We provide a Docker image with the required programs installed, such as Python, Node.js, and AWS CDK.
The source code of the hands-on program has also been included in the image.
If you already know how to use Docker, then you can use this image to immediately start the hands-on tutorials without having to install anything else.</p>
</div>
<div class="paragraph">
<p>See <a href="#sec_handson_docker">Section 5.8</a> for more instructions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ssh">4.2. SSH</h3>
<div class="paragraph">
<p><strong>SSH (secure shell)</strong> is a tool to securely access Unix-like remote servers.
In this hands-on, we will use SSH to access a virtual server.
For readers who are not familiar with SSH, here we give a brief guidance.</p>
</div>
<div class="paragraph">
<p>All SSH communication is encrypted, so confidential information can be sent and received securely over the Internet.
For this hands-on, you need to have an SSH client installed on your local machine to access the remote server.
SSH clients come standard on Linux and Mac.
For Windows, it is recommended to install WSL to use an SSH client (see <a href="#environments">[environments]</a>).</p>
</div>
<div class="paragraph">
<p>The basic usage of the SSH command is shown below.
<code>&lt;host name&gt;</code> is the IP address or DNS hostname of the server to be accessed.
The <code>&lt;user name&gt;</code> is the user name of the server to be connected to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>ssh &lt;user name&gt;@&lt;host name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>SSH can be authenticated using plain text passwords, but for stronger security, it is strongly recommended that you use <strong>Public Key Cryptography</strong> authentication, and EC2 only allows access in this way.
We do not explain the theory of public key cryptography here.
The important point in this hands-on is that the EC2 instance holds the public key, and the client computer (the reader&#8217;s local machine) holds the private key.
Only the computer with the private key can access the EC2 instance.
Conversely, if the private key is leaked, a third party will be able to access the server, so <strong>manage the private key with care to ensure that it is never leaked</strong>.</p>
</div>
<div class="paragraph">
<p>The SSH command allows you to specify the private key file to use for login with the <code>-i</code> or <code>--identity_file</code> option.
For example, use the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>ssh <span class="nt">-i</span> Ec2SecretKey.pem &lt;user name&gt;@&lt;host name&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reading_the_application_source_code">4.3. Reading the application source code</h3>
<div class="paragraph">
<p><a href="#handson_01_architecture">Figure 10</a> shows an overview of the application we will be deploying in this hands-on.</p>
</div>
<div id="handson_01_architecture" class="imageblock text-center">
<div class="content">
<img src="imgs/handson-01/app_architecture.png" alt="hands-on 01 architecture" width="600">
</div>
<div class="title">Figure 10. Application architecture</div>
</div>
<div class="paragraph">
<p>In this application, we first set up a private virtual network environment using <strong>VPC (Virtual Private Cloud)</strong>.
The virtual servers of <strong>EC2 (Elastic Compute Cloud)</strong> are placed inside the public subnet of the VPC.
For security purposes, access to the EC2 instance is restricted by the <strong>Security Group (SG)</strong>.
We will use SSH to access the virtual server and perform a simple calculation.
We use AWS CDK to construct this application.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the source code of the CDK app
(<a href="https://github.com/tomomano/learn-aws-by-coding/blob/main/handson/ec2-get-started/app.py">handson/ec2-get-started/app.py</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">MyFirstEc2</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Stack</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">App</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="n">vpc</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">Vpc</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s">"MyFirstEc2-Vpc"</span><span class="p">,</span>
            <span class="n">max_azs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">cidr</span><span class="o">=</span><span class="s">"10.10.0.0/23"</span><span class="p">,</span>
            <span class="n">subnet_configuration</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ec2</span><span class="o">.</span><span class="n">SubnetConfiguration</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">"public"</span><span class="p">,</span>
                    <span class="n">subnet_type</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">SubnetType</span><span class="o">.</span><span class="n">PUBLIC</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="n">nat_gateways</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="n">sg</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">SecurityGroup</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s">"MyFirstEc2Vpc-Sg"</span><span class="p">,</span>
            <span class="n">vpc</span><span class="o">=</span><span class="n">vpc</span><span class="p">,</span>
            <span class="n">allow_all_outbound</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">sg</span><span class="o">.</span><span class="n">add_ingress_rule</span><span class="p">(</span>
            <span class="n">peer</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">Peer</span><span class="o">.</span><span class="n">any_ipv4</span><span class="p">(),</span>
            <span class="n">connection</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">Port</span><span class="o">.</span><span class="n">tcp</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span>
        <span class="p">)</span>

        <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="n">host</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">Instance</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s">"MyFirstEc2Instance"</span><span class="p">,</span>
            <span class="n">instance_type</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">InstanceType</span><span class="p">(</span><span class="s">"t2.micro"</span><span class="p">),</span>
            <span class="n">machine_image</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">MachineImage</span><span class="o">.</span><span class="n">latest_amazon_linux</span><span class="p">(),</span>
            <span class="n">vpc</span><span class="o">=</span><span class="n">vpc</span><span class="p">,</span>
            <span class="n">vpc_subnets</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">SubnetSelection</span><span class="p">(</span><span class="n">subnet_type</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">SubnetType</span><span class="o">.</span><span class="n">PUBLIC</span><span class="p">),</span>
            <span class="n">security_group</span><span class="o">=</span><span class="n">sg</span><span class="p">,</span>
            <span class="n">key_name</span><span class="o">=</span><span class="n">key_name</span>
        <span class="p">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First, we define the VPC.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Next, we define the security group.
Here, connections from any IPv4 address to port 22 (used for SSH connections) are allowed.
All other connections are rejected.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finally, an EC2 instance is created with the VPC and SG created above.
The instance type is selected as <code>t2.micro</code>, and Amazon Linux is used as the OS.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let us explain each of these points in more detail.</p>
</div>
<div class="sect3">
<h4 id="_vpc_virtual_private_cloud">4.3.1. VPC (Virtual Private Cloud)</h4>
<div id="fig::vpc_logo" class="paragraph">
<div class="title">VPC icon</div>
<p><span class="image"><img src="imgs/aws_logos/VPC.png" alt="VPC" width="100"></span></p>
</div>
<div class="paragraph">
<p>VPC is a tool for building a private virtual network environment on AWS.
In order to build advanced computing systems, it is necessary to connect multiple servers, which requires management of the network addresses.
VPC is useful for such purposes.</p>
</div>
<div class="paragraph">
<p>In this hands-on, only one server is launched, so the benefits of VPC may not be clear to you.
However, since AWS specification require that EC2 instances must be placed inside a VPC, we have configured a minimal VPC in this application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For those who are interested, here is a more advanced explanation of the VPC code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
</pre></td><td class="code"><pre><span class="n">vpc</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">Vpc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="s">"MyFirstEc2-Vpc"</span><span class="p">,</span>
    <span class="n">max_azs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">cidr</span><span class="o">=</span><span class="s">"10.10.0.0/23"</span><span class="p">,</span>
    <span class="n">subnet_configuration</span><span class="o">=</span><span class="p">[</span>
        <span class="n">ec2</span><span class="o">.</span><span class="n">SubnetConfiguration</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">"public"</span><span class="p">,</span>
            <span class="n">subnet_type</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">SubnetType</span><span class="o">.</span><span class="n">PUBLIC</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">],</span>
    <span class="n">nat_gateways</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>max_azs=1</code>: This parameter sets the number of avaialability zones (AZs).
In this hands-on, it is set to <code>1</code> because we don&#8217;t need to worry about the failure of the data center.</p>
</li>
<li>
<p><code>cidr="10.10.0.0/23"</code>: This parameter specifies the range of IPv4 address in the VPC.
For more information about CIDR notation, see
<a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing">Wikipedia article</a>.
<code>10.10.0.0/23</code> refers to a range of 512 consecutive addresses from <code>10.10.0.0</code> to <code>10.10.1.255</code>.
In other words, a maximum of 512 unique IPv4 addresses can be used in this VPC.
In this application, 512 is obviously too many since there is only one server, but since VPCs are free of charge no matter how many addresses are created, we created a big one.</p>
</li>
<li>
<p><code>subnet_configuration=&#8230;&#8203;</code> : This parameter determines what kind of subnet is created in VPC.
There are two types of subnets: <strong>private subnet</strong> and <strong>public subnet</strong>.
A private subnet is basically a subnet environment that is disconnected from the Internet.
Because it is not connected to the Internet, it is extremely secure, and EC2 instances that only need to communicate with servers inside the VPC should be placed here.
The public subnet is a subnet connected to the Internet.
Since we want to use SSH to log in to the server in this hands-on, we will place the EC2 instance in the public subnet.
For more information, refer to
<a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html#vpc-subnet-basics">official documentation "VPC and subnet basics"</a>.</p>
</li>
<li>
<p><code>natgateways=0</code>: This is a bit advanced parameter, so interested readers are referred to <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html">official documentation "NAT gateways"</a>.
Anyhow, <strong>if you don&#8217;t set this to 0, you will be charged for using the NAT Gateway</strong>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_security_group">4.3.2. Security Group</h4>
<div class="paragraph">
<p>A security group (SG) is a virtual firewall that can be assigned to an EC2 instance.
For example, you can allow or deny connections coming from a specific IP address (inbound traffic restriction), and prohibit access to a specific IP address (outbound traffic restriction).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the corresponding part of the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="n">sg</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">SecurityGroup</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="s">"MyFirstEc2Vpc-Sg"</span><span class="p">,</span>
    <span class="n">vpc</span><span class="o">=</span><span class="n">vpc</span><span class="p">,</span>
    <span class="n">allow_all_outbound</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sg</span><span class="o">.</span><span class="n">add_ingress_rule</span><span class="p">(</span>
    <span class="n">peer</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">Peer</span><span class="o">.</span><span class="n">any_ipv4</span><span class="p">(),</span>
    <span class="n">connection</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">Port</span><span class="o">.</span><span class="n">tcp</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, in order to allow SSH connections from the outside, we specified <code>sg.add_ingress_rule(peer=ec2.Peer.any_ipv4(), connection=ec2.Port.tcp(22))</code>, which means that access to port 22 is allowed from all IPv4 addresses.
In addition, the parameter <code>allow_all_outbound=True</code> is set so that the instance can access the Internet freely to download resources.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SSH by default uses port 22 for remote access.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>From a security purpose, it is preferable to allow SSH connections only from specific locations such as home, university, or workplace.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ec2_elastic_compute_cloud">4.3.3. EC2 (Elastic Compute Cloud)</h4>
<div id="fig::ec2_handson_ec2_logo" class="paragraph">
<div class="title">EC2 icon</div>
<p><span class="image"><img src="imgs/aws_logos/EC2.png" alt="EC2" width="100"></span></p>
</div>
<div class="paragraph">
<p>EC2 is a service for setting up virtual servers on AWS.
Each virtual server in a running state is called an <strong>instance</strong>.
(However, in colloquial communication, the terms server and instance are often used interchangeably.)</p>
</div>
<div class="paragraph">
<p>EC2 provides a variety of instance types to suit many use cases.
<a href="#ec2_instance_types">Table 2</a> lists some representative instance types.
A complete list of EC2 instance types can be found at
<a href="https://aws.amazon.com/ec2/instance-types/">Official Documentation "Amazon EC2 Instance Types"</a>.</p>
</div>
<table id="ec2_instance_types" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. EC2 instance types</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instance</th>
<th class="tableblock halign-left valign-top">vCPU</th>
<th class="tableblock halign-left valign-top">Memory (GiB)</th>
<th class="tableblock halign-left valign-top">Network bandwidth (Gbps)</th>
<th class="tableblock halign-left valign-top">Price per hour ($)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">t2.micro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0116</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">t2.small</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.023</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">t2.medium</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0464</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c5.24xlarge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.08</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c5n.18xlarge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.888</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x1e.16xlarge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1952</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13.344</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As can be seen in <a href="#ec2_instance_types">Table 2</a>, the virtual CPUs (vCPUs) can be configured from 1 to 96 cores, memory from 1GB to over 2TB, and network bandwidth up to 100Gbps.
The price per hour increases approximately linearly with the number of vCPUs and memories allocated.
EC2 keeps track of the server running time in seconds, and the usage fee is determined in proportion to the usage time.
For example, if an instance of <code>t2.medium</code> is launched for 10 hours, a fee of 0.0464 * 10 = $0.464 will be charged.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>AWS has a
<a href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc">free EC2 tier</a>.
With this, <code>t2.micro</code> can be used up to 750 hours per month for free.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The price listed in <a href="#ec2_instance_types">Table 2</a> is for the <code>us-east-1</code> region.
Pricing varies slightly by region.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above price of $0.0116 / hour for t2.micro is for the <strong>on-demand instance</strong> type.
In addition to on-demand instance type, there is another type of instance called
<strong><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html">spot instance</a></strong>.
The idea of spot instances is to rent out the excess free CPUs temporarily available at AWS data center to users at a discount.
Therefore, spot instances are offered at a much lower price, but the instance may be forcibly shut down when the load on the AWS data center increases, even if the user&#8217;s program is still running.
There have been many reports of spot instance being used to reduce costs in applications such as scientific computing and web servers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the part of the code that defines the EC2 instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="n">host</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="n">Instance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="s">"MyFirstEc2Instance"</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">InstanceType</span><span class="p">(</span><span class="s">"t2.micro"</span><span class="p">),</span>
    <span class="n">machine_image</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">MachineImage</span><span class="o">.</span><span class="n">latest_amazon_linux</span><span class="p">(),</span>
    <span class="n">vpc</span><span class="o">=</span><span class="n">vpc</span><span class="p">,</span>
    <span class="n">vpc_subnets</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">SubnetSelection</span><span class="p">(</span><span class="n">subnet_type</span><span class="o">=</span><span class="n">ec2</span><span class="o">.</span><span class="n">SubnetType</span><span class="o">.</span><span class="n">PUBLIC</span><span class="p">),</span>
    <span class="n">security_group</span><span class="o">=</span><span class="n">sg</span><span class="p">,</span>
    <span class="n">key_name</span><span class="o">=</span><span class="n">key_name</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we have selected the instance type <code>t2.micro</code>.
In addition, the <code>machine_image</code> is set to
<a href="https://aws.amazon.com/amazon-linux-ami/">Amazon Linux</a>
(Machine image is a concept similar to OS.
We will discuss machine image in more detail in <a href="#sec_jupyter_and_deep_learning">[sec_jupyter_and_deep_learning]</a>.)
In addition, the VPC and SG defined above are assigned to this instance.</p>
</div>
<div class="paragraph">
<p>This is a brief explanation of the program we will be using.
Although it is a minimalist program, we hope it has given you an idea of the steps required to create a virtual server.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec_handson_ec2_run">4.4. Deploying the application</h3>
<div class="paragraph">
<p>Now that we understand the source code, let&#8217;s deploy the application on AWS.
Again, it is assumed that you have finished the preparations described in<a href="#handson_01_prep">Section 4.1</a>.</p>
</div>
<div class="sect3">
<h4 id="_installing_python_dependencies">4.4.1. Installing Python dependencies</h4>
<div class="paragraph">
<p>The first step is to install the Python dependency libraries.
In the following, we use
<a href="https://docs.python.org/3/library/venv.html">venv</a>
as a tool to manage Python libraries.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s move to the directory <code>handson/ec2-get-started</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>handson/ec2-get-started</code></pre>
</div>
</div>
<div class="paragraph">
<p>After moving the directory, create a new virtual environment with <code>venv</code> and run the installation with <code>pip</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>python3 <span class="nt">-m</span> venv .env
<span class="nv">$ </span><span class="nb">source</span> .env/bin/activate
<span class="nv">$ </span>pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>This completes the Python environment setup.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A quick tutorial on <code>venv</code> is provided in <a href="#venv_quick_guide">Section 5.7</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_setting_aws_access_key">4.4.2. Setting AWS access key</h4>
<div class="paragraph">
<p>To use the AWS CLI and AWS CDK, you need to have an AWS access key set up.
Refer to <a href="#aws_secrets">Section 5.2</a> for issuing a access key.
After issuing the access key, refer to <a href="#aws_cli_install">Section 5.3</a> to configure the command line settings.</p>
</div>
<div class="paragraph">
<p>To summarize the procedure shortly, the first method is to set environment variables such as <code>AWS_ACCESS_KEY_ID</code>.
The second method is to store the authentication information in <code>~/.aws/credentials</code>.
Setting an access key is a common step in using the AWS CLI/CDK, so make sure you understand it well.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generating_a_ssh_key_pair">4.4.3. Generating a SSH key pair</h4>
<div class="paragraph">
<p>We login to the EC2 instance using SSH.
Before creating an EC2 instance, you need to prepare an SSH public/private key pair to be used exclusively in this hands-on exercise.</p>
</div>
<div class="paragraph">
<p>Using the following AWS CLI command, let&#8217;s generate a key named <code>OpenSesame</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">export </span><span class="nv">KEY_NAME</span><span class="o">=</span><span class="s2">"OpenSesame"</span>
<span class="nv">$ </span>aws ec2 create-key-pair <span class="nt">--key-name</span> <span class="k">${</span><span class="nv">KEY_NAME</span><span class="k">}</span> <span class="nt">--query</span> <span class="s1">'KeyMaterial'</span> <span class="nt">--output</span> text <span class="o">&gt;</span> <span class="k">${</span><span class="nv">KEY_NAME</span><span class="k">}</span>.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you execute this command, a file named <code>OpenSesame.pem</code> will be created in the current directory.
This is the private key to access the server.
To use this key with SSH, move the key to the directory <code>~/.ssh/</code>.
To prevent the private key from being overwritten or viewed by a third party, you must set the access permission of the file to <code>400</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">mv </span>OpenSesame.pem ~/.ssh/
<span class="nv">$ </span><span class="nb">chmod </span>400 ~/.ssh/OpenSesame.pem</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deploy">4.4.4. Deploy</h4>
<div class="paragraph">
<p>We are now ready to deploy our EC2 instance!
Use the following command to deploy the application on AWS.
The option <code>-c key_name="OpenSesame"</code> specifies to use the key named <code>OpenSesame</code> that we generated earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>cdk deploy <span class="nt">-c</span> <span class="nv">key_name</span><span class="o">=</span><span class="s2">"OpenSesame"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When this command is executed, the VPC, EC2, and other resources will be deployed on AWS.
At the end of the command output, you should get an output like <a href="#handson_01_cdk_output">Figure 11</a>.
<strong>In the output, the digits following <code>InstancePublicIp</code> is the public IP address of the launched instance</strong>.
The IP address is randomly assigned for each deployment.</p>
</div>
<div id="handson_01_cdk_output" class="imageblock text-center">
<div class="content">
<img src="imgs/handson-01/cdk_output.png" alt="cdk output" width="700">
</div>
<div class="title">Figure 11. Output of CDK deploy</div>
</div>
</div>
<div class="sect3">
<h4 id="_log_in_with_ssh">4.4.5. Log in with SSH</h4>
<div class="paragraph">
<p>Let us log in to the instance using SSH.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>ssh <span class="nt">-i</span> ~/.ssh/OpenSesame.pem ec2-user@&lt;IP address&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>-i</code> option specifies the private key that was generated earlier.
Since the EC2 instance by default has a user named <code>ec2-user</code>, use this as a login user name.
Lastly, replace <code>&lt;IP address&gt;</code> with the IP address of the EC2 instance you created (e.g., <code>12.345.678.9</code>).</p>
</div>
<div class="paragraph">
<p>If the login is successful, you will be taken to a terminal window like <a href="#fig_handson_01_ssh_login">Figure 12</a>.
Since you are logging in to a remote server, make sure the prompt looks like <code>[ec2-user@ip-10-10-1-217 ~]$</code>.</p>
</div>
<div id="fig_handson_01_ssh_login" class="imageblock text-center">
<div class="content">
<img src="imgs/handson-01/ssh_login.png" alt="ssh_login" width="700">
</div>
<div class="title">Figure 12. Log in to the EC2 instance using SSH</div>
</div>
<div class="paragraph">
<p><strong>Congratulations!
You have successfully launched an EC2 virtual instance on AWS, and you can access it remotely!</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_exploring_the_launched_ec2_instance">4.4.6. Exploring the launched EC2 instance</h4>
<div class="paragraph">
<p>Now that we have a new instance up and running, let&#8217;s play with it.</p>
</div>
<div class="paragraph">
<p>Inside the EC2 instance you logged into, run the following command.
The command will output the CPU information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">cat</span> /proc/cpuinfo

processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 63
model name	: Intel<span class="o">(</span>R<span class="o">)</span> Xeon<span class="o">(</span>R<span class="o">)</span> CPU E5-2676 v3 @ 2.40GHz
stepping	: 2
microcode	: 0x43
cpu MHz		: 2400.096
cache size	: 30720 KB</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, let&#8217;s use <code>top</code> command and show the running processes and memory usage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span> top <span class="nt">-n</span> 1

top - 09:29:19 up 43 min,  1 user,  load average: 0.00, 0.00, 0.00
Tasks:  76 total,   1 running,  51 sleeping,   0 stopped,   0 zombie
Cpu<span class="o">(</span>s<span class="o">)</span>:  0.3%us,  0.3%sy,  0.1%ni, 98.9%id,  0.2%wa,  0.0%hi,  0.0%si,  0.2%st
Mem:   1009140k total,   270760k used,   738380k free,    14340k buffers
Swap:        0k total,        0k used,        0k free,   185856k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
    1 root      20   0 19696 2596 2268 S  0.0  0.3   0:01.21 init
    2 root      20   0     0    0    0 S  0.0  0.0   0:00.00 kthreadd
    3 root      20   0     0    0    0 I  0.0  0.0   0:00.00 kworker/0:0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we are using <code>t2.micro</code> instance, we have 1009140k = 1GB memory in the virtual instance.</p>
</div>
<div class="paragraph">
<p>The instance we started has Python 2 installed, but not Python 3.
Let&#8217;s install Python 3.6.
The installation is easy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>yum update <span class="nt">-y</span>
<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> python36</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start Python 3 interpreter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>python3
Python 3.6.10 <span class="o">(</span>default, Feb 10 2020, 19:55:14<span class="o">)</span>
<span class="o">[</span>GCC 4.8.5 20150623 <span class="o">(</span>Red Hat 4.8.5-28<span class="o">)]</span> on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To exit from the interpreter, use <code>Ctrl + D</code> or type <code>exit()</code>.</p>
</div>
<div class="paragraph">
<p>So, that&#8217;s it for playing around on the server (if you&#8217;re interested, you can try different things!).
Log out from the instance with the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">exit</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_observing_the_resources_from_aws_console">4.4.7. Observing the resources from AWS console</h4>
<div class="paragraph">
<p>So far we have performed all EC2-related operations from the command line.
Operations such as checking the status of an EC2 instance or shutting down a server can also be performed from the AWS console.
Let&#8217;s take a quick look at this.</p>
</div>
<div class="paragraph">
<p>First, open a web browser and log in to the AWS console.
Once you are logged in, search <code>EC2</code> from <code>Services</code> and go to the EC2 dashboard.
Next, navigate to <code>Instances</code> in the left sidebar.
You should get a screen like <a href="#aws_ec2_console">Figure 13</a>.
On this screen, you can check the instances under your account.
Similarly, you can also check the VPC and SG from the console.</p>
</div>
<div id="aws_ec2_console" class="imageblock text-center">
<div class="content">
<img src="imgs/handson-01/ec2_console.png" alt="ec2_console" width="700">
</div>
<div class="title">Figure 13. EC2 dashboard</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure that the correct region (in this case, <code>ap-northeast-1</code>) is selected in the AWS console!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As mentioned in the previous chapter, the application deployed here is managed as a CloudFormation stack.
A <strong>stack</strong> refers to a group of AWS resources.
In this case, VPC, SG, and EC2 are included in the same stack.
From the AWS console, let&#8217;s go to the <code>CloudFormation</code> dashboard (<a href="#aws_cloudformation_console">Figure 14</a>).</p>
</div>
<div id="aws_cloudformation_console" class="imageblock text-center">
<div class="content">
<img src="imgs/handson-01/cloudformation_console.png" alt="cloudformation console" width="700">
</div>
<div class="title">Figure 14. CloudFormation dashboard</div>
</div>
<div class="paragraph">
<p>You should be able find a stack named "MyFirstEc2".
If you click on it and look at the contents, you will see that EC2, VPC, and other resources are associated to this stack.</p>
</div>
</div>
<div class="sect3">
<h4 id="handson_01_delete_stack">4.4.8. Deleting the stack</h4>
<div class="paragraph">
<p>We have explained everything that was to be covered in the first hands-on session.
Finally, we must delete the stack that is no longer in use.
There are two ways to delete a stack.</p>
</div>
<div class="paragraph">
<p>The first method is to press the "Delete" button on the Cloudformation dashboard (<a href="#cloudformation_delete">Figure 15</a>).
Then, the status of the stack will change to <code>"DELETE_IN_PROGRESS"</code>, and when the deletion is completed, the stack will disappear from the list of CloudFormation stacks.</p>
</div>
<div id="cloudformation_delete" class="imageblock text-center">
<div class="content">
<img src="imgs/handson-01/cloudformation_delete.png" alt="cloudformation delete" width="700">
</div>
<div class="title">Figure 15. Deleting a stack from CloudFormation dashboard</div>
</div>
<div class="paragraph">
<p>The second method is to use the command line.
Let&#8217;s go back to the command line where we ran the deployment.
Then, execute the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>cdk destroy</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you execute this command, the stack will be deleted.
After deleting the stack, make sure for yourself that all the VPCs, EC2s, etc. have disappeared without a trace.
Using CloudFormation is very convenient because it allows you to manage and delete all related AWS resources at once.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Make sure you delete your own stack!</strong>
If you do not do so, you will continue to be charged for the EC2 instance!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also, delete the SSH key pair created for this hands-on, as it is no longer needed.
First, delete the public key registered on the EC2 side.
This can be done in two ways: from the console or from the command line.</p>
</div>
<div class="paragraph">
<p>To do this from the console, go to the <code>EC2</code> dashboard and select <code>Key Pairs</code> from the left sidebar.
When a list of keys is displayed, check the key labeled <code>OpenSesame</code> and execute <code>Delete</code> from <code>Actions</code> in the upper right corner of the screen (<a href="#delete_ec2_key_pair">Figure 16</a>).</p>
</div>
<div id="delete_ec2_key_pair" class="imageblock text-center">
<div class="content">
<img src="imgs/handson-01/ec2_keypair_console.png" alt="ec2_keypair_console" width="700">
</div>
<div class="title">Figure 16. Deleting a SSH key pair on EC2 dashboard</div>
</div>
<div class="paragraph">
<p>To do the same operation from the command line, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>aws ec2 delete-key-pair <span class="nt">--key-name</span> <span class="s2">"OpenSesame"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, delete the key from your local machine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-f</span> ~/.ssh/OpenSesame.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we&#8217;re all done cleaning up the cloud.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you frequently start EC2 instances, you do not need to delete the SSH key every time.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary">4.5. Summary</h3>
<div class="paragraph">
<p>This is the end of the first part of the book.
We hope you have been able to follow the contents without much trouble.</p>
</div>
<div class="paragraph">
<p>In <a href="#chap_cloud_basics">Section 2</a>, the definition of cloud and important terminology were explained, and then the reasons for using cloud were discussed.
Then, in <a href="#sec_aws_general_introduction">Section 3</a>, AWS was introduced as a platform to learn about cloud computing, and the minimum knowledge and terminology required to use AWS were explained.
In the hands-on session in <a href="#sec_first_ec2">Section 4</a>, we used AWS CLI and AWS CDK to set up our own private server on AWS.</p>
</div>
<div class="paragraph">
<p>You can now experience how easy it is to start up and remove virtual servers (with just a few commands!).
We mentioned in <a href="#chap_cloud_basics">Section 2</a> that the most important aspect of the cloud is the ability to dynamically expand and shrink computational resources.
We hope that the meaning of this phrase has become clearer through the hands-on experience.
Using this simple tutorial as a template, you can customize the code for your own appplications, such as creating a virtual server to host your web pages, prepare an EC2 instance with a large number of cores to run scientific computations, and many more.</p>
</div>
<div class="paragraph">
<p>In the next chapter, you will experience solving more realistic problems based on the cloud technology you have learned.
Stay tuned!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec:appendix_settingup">5. Appendix: Environment setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To read through this book, you need to set up an environment on your local machine to run the hands-on programs.
Assuming that you are a beginner in AWS and the command line, this chapter will briefly explain how to install the necessary software and libraries.
A brief table of contents is shown below.
If you have already built your environment, you need to read through only the relevant parts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating an AWS account (<a href="#sec:create_aws_account">Section 5.1</a>)</p>
</li>
<li>
<p>Creating AWS access key (<a href="#aws_secrets">Section 5.2</a>)</p>
</li>
<li>
<p>Installing AWS CLI (<a href="#aws_cli_install">Section 5.3</a>)</p>
</li>
<li>
<p>Installing AWS CDK (<a href="#aws_cdk_install">Section 5.4</a>)</p>
</li>
<li>
<p>Installing WSL (<a href="#sec:install_wsl">Section 5.5</a>)</p>
</li>
<li>
<p>Installing Docker (<a href="#sec:install_docker">Section 5.6</a>)</p>
</li>
<li>
<p>Quick tutorial on Python venv (<a href="#venv_quick_guide">Section 5.7</a>)</p>
</li>
<li>
<p>Working with Docker image for the hands-on exercises (<a href="#sec_handson_docker">Section 5.8</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The OS can be Linux, Mac, or Windows.
Windows users are assumed to use Windows Subsytem for Linux (WSL) (<a href="#sec:install_wsl">Section 5.5</a>).</p>
</div>
<div class="paragraph">
<p>You can also use the
<a href="https://hub.docker.com/repository/docker/tomomano/labc">Docker image</a>
to run the hands-on programs in this book.
This will be useful for readers who know how to use Docker, as it allows them to skip AWS CLI/CDK and Python installation.</p>
</div>
<div class="sect2">
<h3 id="sec:create_aws_account">5.1. Creating an AWS account</h3>
<div class="paragraph">
<p>In order to try the hands-on exercises provided in this book, you need to create your own AWS account.
Detailed instructions for creating an account can be found at
<a href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/">official documentation</a>,
so please refer to that as well.
Follow the steps below to create an account.</p>
</div>
<div class="paragraph">
<p>First, access <a href="https://aws.amazon.com/console/">AWS Management Console</a> from your web browser, and click <code>Create an AWS Account</code> in the upper right corner.
(<a href="#fig:aws-signup-1">Figure 17</a>, boxed with a solid line).</p>
</div>
<div id="fig:aws-signup-1" class="imageblock text-center">
<div class="content">
<img src="imgs/signup-1.png" alt="signup-1" width="500">
</div>
<div class="title">Figure 17. Sign up (1) - Accessing AWS Management Console</div>
</div>
<div class="paragraph">
<p>Then, you will be taken to a page where you register your email address and password (<a href="#fig:aws-signup-3">Figure 18</a>).</p>
</div>
<div id="fig:aws-signup-3" class="imageblock text-center">
<div class="content">
<img src="imgs/signup-3.png" alt="signup-3" width="500">
</div>
<div class="title">Figure 18. Sign up (2): Register email and password</div>
</div>
<div class="paragraph">
<p>Next, you will be asked to enter your address, phone number, and other information (<a href="#fig:aws-signup-4">Figure 19</a>).</p>
</div>
<div id="fig:aws-signup-4" class="imageblock text-center">
<div class="content">
<img src="imgs/signup-4.png" alt="signup-4" width="500">
</div>
<div class="title">Figure 19. Sign up (3): Entering address and phone number</div>
</div>
<div class="paragraph">
<p>Next, you will be asked to register your credit card information (<a href="#fig:aws-signup-5">Figure 20</a>).
If you are using AWS as an individual, you will be billed for your usage via your credit card.
Note that you cannot start using AWS without registering your credit card information.</p>
</div>
<div id="fig:aws-signup-5" class="imageblock text-center">
<div class="content">
<img src="imgs/signup-5.png" alt="signup-5" width="500">
</div>
<div class="title">Figure 20. Sign up (4): Registering a credit card</div>
</div>
<div class="paragraph">
<p>On the next page, you will be asked to verify your identity using SMS or voice message on your cell phone (<a href="#fig:aws-signup-6">Figure 21</a>).
Select your preferred authentication method and enter your cell phone number.</p>
</div>
<div id="fig:aws-signup-6" class="imageblock text-center">
<div class="content">
<img src="imgs/signup-6.png" alt="signup-6" width="500">
</div>
<div class="title">Figure 21. Sign up (5): Identify verification by cell phone</div>
</div>
<div class="paragraph">
<p>After successfully verifying your identity, you will be asked to select a support plan (<a href="#fig:aws-signup-8">Figure 22</a>).
You can just select the Basic support plan, which is free.</p>
</div>
<div id="fig:aws-signup-8" class="imageblock text-center">
<div class="content">
<img src="imgs/signup-8.png" alt="signup-8" width="500">
</div>
<div class="title">Figure 22. Sign up (6): Selecting a support plan</div>
</div>
<div class="paragraph">
<p>These steps will complete the creation of your account (<a href="#fig:aws-signup-9">Figure 23</a>).
Let&#8217;s log in and see if we can access the AWS console.</p>
</div>
<div id="fig:aws-signup-9" class="imageblock text-center">
<div class="content">
<img src="imgs/signup-9.png" alt="signup-9" width="500">
</div>
<div class="title">Figure 23. Sign up (7): Sign up is complete!</div>
</div>
</div>
<div class="sect2">
<h3 id="aws_secrets">5.2. Creating AWS access key</h3>
<div class="paragraph">
<p>AWS access key is a key used for user authentication when operating the AWS API from the AWS CLI or AWS CDK.
To use the AWS CLI/CDK, you need to issue a secret key first.
For more information on AWS secret keys, please refer to
<a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html">the official documentation "Understanding and getting your AWS credentials"</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, log in to your AWS console</p>
</li>
<li>
<p>Then, click on your account name in the upper right corner of the screen, and select "My Security Credentials" from the pull-down menu (<a href="#fig:aws_secret_key_1">Figure 24</a>)</p>
</li>
<li>
<p>Under "Access keys for CLI, SDK, &amp; API access", find the button that says "Create accesss key" and click it (<a href="#fig:aws_secret_key_2">Figure 25</a>)</p>
</li>
<li>
<p>Record the displayed access key ID and secret access key (if you close the window, they will not be displayed again)</p>
</li>
<li>
<p>If you forget your key, you can reissue it by the same procedure</p>
</li>
<li>
<p>Use the issued secret key by writing it to the file <code>~/.aws/credentials</code> or by setting it to an environment variable (also see <a href="#aws_cli_install">Section 5.3</a>)</p>
</li>
</ol>
</div>
<div id="fig:aws_secret_key_1" class="imageblock text-center">
<div class="content">
<img src="imgs/aws_secret_key_1.png" alt="aws_secret_key_1" width="400">
</div>
<div class="title">Figure 24. Creating an AWS secret key (1)</div>
</div>
<div id="fig:aws_secret_key_2" class="imageblock text-center">
<div class="content">
<img src="imgs/aws_secret_key_2.png" alt="aws_secret_key_2" width="700">
</div>
<div class="title">Figure 25. Creating an AWS secret key (2)</div>
</div>
</div>
<div class="sect2">
<h3 id="aws_cli_install">5.3. Installing AWS CLI</h3>
<div class="paragraph">
<p>This is a brief description of the installation procedure for Linux at the time of writing.
Please remember to always check
<a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html">official documentation</a>
for the latest information, as it may change in future versions.</p>
</div>
<div class="paragraph">
<p>Installation of AWS CLI version 2 can be done by downloading and executing the installation script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>curl <span class="s2">"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip"</span> <span class="nt">-o</span> <span class="s2">"awscliv2.zip"</span>
<span class="nv">$ </span>unzip awscliv2.zip
<span class="nv">$ </span><span class="nb">sudo</span> ./aws/install</code></pre>
</div>
</div>
<div class="paragraph">
<p>To confirm that the installation is successful, type the following command to see if the version information is displayed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>aws <span class="nt">--version</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the installation is complete, run the following command to finish the initial set up (also see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">official documentation "Configuring the AWS CLI"</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>aws configure</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you execute this command, you will be prompted to enter the <code>AWS Access Key ID</code> and <code>AWS Secret Access Key</code>.
See <a href="#aws_secrets">Section 5.2</a> for issuing access keys.
The command also asks for the <code>Default region name</code>.
You can specify your favorite region (e.g. <code>ap-northeast-1</code> = Tokyo) here.
The last entry, <code>Default output format</code>, should be <code>json</code>.</p>
</div>
<div class="paragraph">
<p>After completing this command, you should see files named <code>~/.aws/credentials</code> and <code>~/.aws/config</code>, where the relevant information is stored.
To be sure, you can use the <code>cat</code> command to check the contents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">cat</span> ~/.aws/credentials
<span class="o">[</span>default]
aws_access_key_id <span class="o">=</span> XXXXXXXXXXXXXXXXXX
aws_secret_access_key <span class="o">=</span> YYYYYYYYYYYYYYYYYYY

<span class="nv">$ </span><span class="nb">cat</span> ~/.aws/config
<span class="o">[</span>profile default]
region <span class="o">=</span> ap-northeast-1
output <span class="o">=</span> json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Authentication key information is stored in <code>~/.aws/credentials</code>, and AWS CLI settings are stored in <code>~/.aws/config</code>.</p>
</div>
<div class="paragraph">
<p>By default, a profile is saved with the name <code>[default]</code>.
If you want to use several different profiles, follow the default example and add a profile with your favorite name.</p>
</div>
<div class="paragraph">
<p>In order to swtich your profile when executing AWS CLI commands, add <code>--profile</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>aws s3 <span class="nb">ls</span> <span class="nt">--profile</span> myprofile</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you find that adding <code>--profile</code> each time you run a command is tedious, you can set the environemntal variable named <code>AWS_PROFILE</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">export </span><span class="nv">AWS_PROFILE</span><span class="o">=</span>myprofile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, you can set the access key information in the environmental variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>XXXXXX
<span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>YYYYYY
<span class="nb">export </span><span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span>ap-northeast-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>These environmental variables have higher priority than the profiles defined in <code>~/.aws/credentials</code>, so the profie defined by environemtal variables are used (see also
<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">official documentation "Configuring the AWS CLI"</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="aws_cdk_install">5.4. Installing AWS CDK</h3>
<div class="paragraph">
<p>This is a brief description of the installation procedure for Linux at the time of writing.
Please remember to always check
<a href="https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html">official documentation</a>
for the latest information, as it may change in future versions.</p>
</div>
<div class="paragraph">
<p>If you have Node.js installed, you can install AWS CDK by the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>npm <span class="nb">install</span> <span class="nt">-g</span> aws-cdk</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The hands-on exercises were developed with AWS CDK version 1.100.
Since CDK is a library under active development, the API may change in the future.
If errors occur due to API changes, it is recommended to use version 1.100.0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> aws-cdk@1.100</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To confirm that the installation is successful, type the following command to see if the version information is displayed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>cdk <span class="nt">--version</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the installation is complete, run the following command to finish the initial set up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>cdk bootstrap</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you run <code>cdk bootstrap</code>, make sure that your AWS credentials and region are set correctly.
By default, the default profile in <code>~/.aws/config</code> is used.
If you want to use a profile other than the default, use the technique described in <a href="#aws_cli_install">Section 5.3</a> to switch profiles.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The configuration of AWS credentials for CDK is basically the same as that of AWS CLI.
See <a href="#aws_cli_install">Section 5.3</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sec:install_wsl">5.5. Installing WSL</h3>
<div class="paragraph">
<p>In this book, the commands are basically written with a UNIX terminal in mind.
Linux and Mac users can use the terminal that comes standard with their OS.
If you are using Windows, we recommend that you use
<a href="https://docs.microsoft.com/en-us/windows/wsl/">Windows Subsystem for Linux (WSL)</a>
to create a virtual Linux environment.
Other tools that emulate the Linux environment, such as
<a href="https://www.cygwin.com/">Cygwin</a>,
are also acceptable, but the programs in this book have been tested only on WSL.</p>
</div>
<div class="paragraph">
<p>WSL is software officially provided by Microsoft to run a Linux virtual environment on a Windows OS.
You can select the Linux distribution you want, such as Ubuntu, and use basically all programs and software made for Linux.</p>
</div>
<div class="paragraph">
<p>At the time of writing,
<a href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions#whats-new-in-wsl-2">WSL 2</a>
is the latest release.
In the following, we will explain the steps to install WSL 2.
For more details, also refer to the
<a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">official documentation</a>.</p>
</div>
<div class="paragraph">
<p>As a prerequisite, the OS must be Windows 10 (Pro or Home edition).
Furthermore, make sure that the version of Windows 10 you are using supports WSL.
For X64 systems, it must be Version 1903, Build 18362 or higher.
If the version does not support WSL, update Windows first.</p>
</div>
<div class="paragraph">
<p>First, start PowerShell with administrator privileges (<a href="#fig:powershell">Figure 26</a>).
To do this, type <code>powershell</code> in the search bar of the Windows menu in the lower left corner, and you should find the PowerShell program.
Then, right-click on it, and select <code>Run as administrator</code> to launch.</p>
</div>
<div id="fig:powershell" class="imageblock text-center">
<div class="content">
<img src="imgs/wsl/powershell.png" alt="powershell" width="500">
</div>
<div class="title">Figure 26. Starting PowerShell with administrator privileges</div>
</div>
<div class="paragraph">
<p>Once the PowerShell is ready, execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the execution, make sure that the command outputs the line <code>â€œThe operation completed successfullyâ€</code>.
Now WSL is enabled on your Windows.</p>
</div>
<div class="paragraph">
<p>Next, using the same PowerShell started with administrator privileges, execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the execution, make sure that the command outputs the line <code>â€œThe operation completed successfullyâ€</code>.
Once this is done, restart your computer.</p>
</div>
<div class="paragraph">
<p>Next, download <strong>Linux kernel update package</strong> from the following link:
<a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi" class="bare">https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi</a></p>
</div>
<div class="paragraph">
<p>Double-click on the downloaded file to run it.
Follow the dialog to complete the installation.</p>
</div>
<div class="paragraph">
<p>After that, come back to PowerShell and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">wsl <span class="nt">--set-default-version</span> 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, install the Linux distribution of your choice.
In this tutorial, let&#8217;s install <strong>Ubuntu 20.04</strong>.</p>
</div>
<div class="paragraph">
<p>Launch the Microsoft Store app and type <code>Ubuntu</code> in the search bar.
Open Ubuntu 20.04 LTS and click the "Get" button (<a href="#fig:microsoft_store">Figure 27</a>).
Wait for a while, and the installation of Ubuntu 20.04 will be completed.</p>
</div>
<div id="fig:microsoft_store" class="imageblock text-center">
<div class="content">
<img src="imgs/wsl/microsoft_store.png" alt="microsoft_store" width="500">
</div>
<div class="title">Figure 27. Installing Ubuntu 20.04 from Microsoft Store</div>
</div>
<div class="paragraph">
<p>The first time you start Ubuntu 20.04, the initial setup will start automatically and you will have to wait for a few minutes.
After the initial setup, you will be prompted to enter your user name and password.</p>
</div>
<div class="paragraph">
<p>This completes the installation of WSL2.
Let&#8217;s launch WSL2!
Type <code>Ubuntu</code> in the search bar of the Windows menu in the lower left corner, and you should find Ubuntu 20.04 (<a href="#fig:ubuntu">Figure 28</a>).
Click on it to start it.</p>
</div>
<div id="fig:ubuntu" class="imageblock text-center">
<div class="content">
<img src="imgs/wsl/ubuntu2004.png" alt="ubuntu2004" width="500">
</div>
<div class="title">Figure 28. Launching Ubuntu 20.04</div>
</div>
<div class="paragraph">
<p>This should bring up a black terminal screen (<a href="#fig:wsl_window">Figure 29</a>).
Try typing <code>ls</code>, <code>top</code>, etc. to confirm that WSL is working properly.</p>
</div>
<div id="fig:wsl_window" class="imageblock text-center">
<div class="content">
<img src="imgs/wsl/wsl_window.png" alt="wsl_window" width="500">
</div>
<div class="title">Figure 29. WSL terminal</div>
</div>
<div class="paragraph">
<p>Optionally, you can install
<a href="https://docs.microsoft.com/en-us/windows/terminal/get-started">Windows Terminal</a>.
Windows Terminal is a tool provided by Microsoft, which gives you more functional and comfortable interface to work with WSL.
We recommend that you to install this tool.</p>
</div>
</div>
<div class="sect2">
<h3 id="sec:install_docker">5.6. Installing Docker</h3>
<div class="paragraph">
<p>The installation method of Docker varies depending on the OS.</p>
</div>
<div class="paragraph">
<p>Mac users should install Docker Desktop.
All you need do is to download Docker Desktop for Mac from
<a href="https://docs.docker.com/docker-for-mac/install/">Docker&#8217;s website</a>,
double-click the downloaded file, and then drag it to the <code>Applications</code> folder.
For more information, see
<a href="https://docs.docker.com/docker-for-mac/install/">official documentation</a>.</p>
</div>
<div class="paragraph">
<p>Windows users should install Docker Desktop.
WSL 2 must be installed in your machine prior to installing Docker Desktop.
See
<a href="https://docs.docker.com/desktop/windows/install/">official documentation</a>
for more information.
After installing Docker Desktop, you can use the <code>docker</code> command from WSL.</p>
</div>
<div class="paragraph">
<p>For Linux users (especially Ubuntu users), there are several approaches to installation.
For more information, please refer to
<a href="https://docs.docker.com/engine/install/ubuntu/">official documentation</a>.
The simplest approach is to use the official Docker installation script.
In this case, the following command will install Docker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>curl <span class="nt">-fsSL</span> https://get.docker.com <span class="nt">-o</span> get-docker.sh
<span class="nv">$ </span><span class="nb">sudo </span>sh get-docker.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the default installation, only the root user is allowed to use the <code>docker</code> command.
Therefore, you need to add <code>sudo</code> to the command every time.
If you find this cumbersome, follow these steps to add the user you are working with to the <code>docker</code> group
(For more information see
<a href="https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user">official documentation "Post-installation steps for Linux"</a>).</p>
</div>
<div class="paragraph">
<p>The first step is to add a group named <code>docker</code>.
Depending on your installation, the <code>docker</code> group may already be created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>groupadd docker</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, add the user you are currently using to the <code>docker</code> group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="nv">$USER</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is done, log out and log back in.
The changes to the group will be reflected in your terminal session.</p>
</div>
<div class="paragraph">
<p>To check if the settings are correct, run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>docker run hello-world</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you can run the container withoug adding <code>sudo</code>, the setting is complete.</p>
</div>
</div>
<div class="sect2">
<h3 id="venv_quick_guide">5.7. Quick tutorial on Python <code>venv</code></h3>
<div class="paragraph">
<p>Many of you may have experienced a situation where a program given to you by someone else does not work because of the library version mismatch.
If you have only one Python environment in your machine, you will have to re-install the correct version every time you switch projects.
This is a lot of work!</p>
</div>
<div class="paragraph">
<p>To make code sharing smoother, library versions should be managed on a project-by-project basis.
This is made possible by tools called <strong>Python virtual environments</strong>.
Programs such as
<a href="https://docs.python.org/3/tutorial/venv.html">venv</a>,
<a href="https://github.com/pyenv/pyenv">pyenv</a>,
and
<a href="https://docs.conda.io/en/latest/">conda</a>
are often used for this purpose.</p>
</div>
<div class="paragraph">
<p>Among them,  <code>venv</code> is very useful because it is included in Python as a standard feature.
Tools like <code>pyenv</code> and <code>conda</code> require separate installation, but they have their own advantages.</p>
</div>
<div class="paragraph">
<p>To create a new virtual environment using <code>venv</code>, you run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>python <span class="nt">-m</span> venv .env</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will create a directory <code>.env/</code> in which the libraries for this virtual environment will be saved.</p>
</div>
<div class="paragraph">
<p>To activate this new virtual environment, you run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">source</span> .env/bin/activate</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the shell prompt starts with <code>(.env)</code> (<a href="#fig_venv_prompt">Figure 30</a>).
This is a sign that signifies, "You are now in a venv".</p>
</div>
<div id="fig_venv_prompt" class="imageblock text-center">
<div class="content">
<img src="imgs/venv_shell.png" alt="venv shell" width="500">
</div>
<div class="title">Figure 30. Shell prompt after activating venv</div>
</div>
<div class="paragraph">
<p>When the virtual Python environment is activated, all subsequent <code>pip</code> commands will install libraries under <code>.env/</code> directory.
In this way, you can separate the version of the library used for each project.</p>
</div>
<div class="paragraph">
<p>In Python, it is common practice to describe the dependent libraries in a file called <code>requirements.txt</code>.
If a project you are workin on has a <code>requirements.txt</code> file defined, you can use the following command to install dependent libraries and reproduce the Python environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can give arbitrary name to the directory where the virtual environment is saved by <code>venv</code>, but the name <code>.env</code> is commonly used.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sec_handson_docker">5.8. Working with Docker image for the hands-on exercise</h3>
<div class="paragraph">
<p>We prepared a Docker image with Node.js, Python, AWS CDK, etc. installed, which is necessary to run the hands-on exercises.
Using this image, you can run the hands-on code immediately without having to install anything on your local machine.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some of the commands in the hands-on must be executed outside of Docker (i.e. in the real environment on your local machine).
These are described as notes in the corresponding part of the hands-on.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Docker image is provided at
<a href="https://hub.docker.com/repository/docker/tomomano/labc">the author&#8217;s Docker Hub repository</a>ï¼Ž
The build file for the Docker image is available at
<a href="https://github.com/tomomano/learn-aws-by-coding-source-code/blob/main/docker/Dockerfile">GitHub</a>.</p>
</div>
<div class="paragraph">
<p>Use the following command to launch the container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>docker run <span class="nt">-it</span> tomomano/labc:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first time you run the command, the image will be downloaded (pulled) from Docker Hub.
From the second time onward, the locally downloaded image will be used.</p>
</div>
<div class="paragraph">
<p>When the container is started, you should see an interactive shell like the following (note the <code>-it</code> option at startup).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>root@aws-handson:~$</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the container shell, if you type the <code>ls</code> command, you should find a directory <code>handson/</code>.
Now you move to this directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cd handson</pre>
</div>
</div>
<div class="paragraph">
<p>You will find a directory for each hands-on.
Then, you can move the directory for each exercise, create a Python virtual environment, and deploy the stack (see <a href="#sec_handson_ec2_run">Section 4.4</a>, etc.).
Since each hands-on uses different dependent libraries, the design is to create a virtualenv for each hands-on.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to set your AWS credentials.
An easy way to do this is to set environment variables such as <code>AWS_ACCESS_KEY_ID</code> as described in <a href="#aws_cli_install">Section 5.3</a>.
Alternatively, if your credentials are stored in local machine&#8217;s <code>~/.aws/credentials</code>, you can <strong>mount</strong> this directory in the container and refer to the same credentials file from inside the container.
If you take this option, start the container with the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">-v</span> ~/.aws:/root/.aws:ro tomomano/labc:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows you to mount <code>~/.aws</code> on the local machine to <code>/root/.aws</code> in the container.
The <code>:ro</code> at the end means read-only.
It is recommended to add the read-only flag to prevent accidental rewriting of important authentication files.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>/root/</code> is the home directory in the container environment.
The technique of mounting the authentication file described here can also be used when passing SSH keys to the container.</p>
</div>
</td>
</tr>
</table>
</div>
<style>
  .imageblock > .title {
    text-align: inherit;
  }
</style>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0-en<br>
Last updated 2021-09-22 02:16:17 UTC
</div>
</div>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</body>
</html>